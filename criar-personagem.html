<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Personagem - GURPS Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@400;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style-atributos.css">
    <link rel="stylesheet" href="style-caracteristicas.css">
    <link rel="stylesheet" href="style-vantagens.css">
   <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-dark: #1a1200;
    --secondary-dark: #2c2008;
    --primary-gold: #d4af37;
    --secondary-gold: #f4d03f;
    --accent-red: #8b0000;
    --accent-green: #2e5c3a;
    --text-light: #f5f5dc;
    --text-gold: #ffd700;
    --parchment: #f7f3e9;
    --wood-dark: #5d4037;
    --wood-light: #8d6e63;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

body {
    font-family: 'Cinzel', serif;
    background-color: var(--primary-dark);
    background-image: 
        radial-gradient(circle at 10% 20%, rgba(44, 32, 8, 0.5) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(42, 21, 11, 0.5) 0%, transparent 20%);
    color: var(--text-light);
    min-height: 100vh;
    position: relative;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M0,0 L100,0 L100,100 L0,100 Z" fill="none" stroke="%232c2008" stroke-width="0.5"/></svg>'),
        linear-gradient(0deg, transparent 24%, rgba(139, 0, 0, 0.05) 25%, rgba(139, 0, 0, 0.05) 26%, transparent 27%, transparent 74%, rgba(139, 0, 0, 0.05) 75%, rgba(139, 0, 0, 0.05) 76%, transparent 77%, transparent);
    background-size: 50px 50px, 10px 10px;
    opacity: 0.3;
    z-index: -1;
}

/* HEADER PRINCIPAL */
.header {
    background: linear-gradient(145deg, rgba(44, 32, 8, 0.95), rgba(26, 18, 0, 0.95));
    border-bottom: 3px solid var(--primary-gold);
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo h1 {
    font-family: 'Uncial Antiqua', cursive;
    font-size: 1.8rem;
    color: var(--text-gold);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

.character-header {
    display: flex;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.character-name-input {
    background: rgba(212, 175, 55, 0.15);
    border: 2px solid var(--primary-gold);
    border-radius: 8px;
    padding: 10px 20px;
    color: var(--text-gold);
    font-family: 'Cinzel', serif;
    font-size: 1.1rem;
    min-width: 250px;
    text-align: center;
    transition: all 0.3s ease;
}

.character-name-input:focus {
    outline: none;
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
    transform: scale(1.02);
}

.character-name-input::placeholder {
    color: rgba(212, 175, 55, 0.6);
}

.btn-voltar {
    background: linear-gradient(145deg, rgba(139, 0, 0, 0.1), rgba(44, 32, 8, 0.8));
    color: var(--text-light);
    border: 2px solid var(--wood-light);
    border-radius: 8px;
    padding: 10px 20px;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.btn-voltar:hover {
    background: linear-gradient(145deg, rgba(139, 0, 0, 0.3), rgba(44, 32, 8, 0.9));
    border-color: var(--primary-gold);
    transform: translateY(-2px);
}

/* MENU DE ABAS - TOPO */
.main-nav {
    background: linear-gradient(145deg, rgba(44, 32, 8, 0.95), rgba(26, 18, 0, 0.95));
    border-bottom: 2px solid var(--wood-dark);
    border-top: 1px solid rgba(212, 175, 55, 0.2);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.nav-scroll-container {
    overflow-x: auto;
    padding: 5px 15px;
    scrollbar-width: thin;
    scrollbar-color: var(--primary-gold) var(--secondary-dark);
    min-height: 60px;
    display: flex;
    align-items: center;
}

.nav-scroll-container::-webkit-scrollbar {
    height: 8px;
}

.nav-scroll-container::-webkit-scrollbar-track {
    background: var(--secondary-dark);
    border-radius: 4px;
}

.nav-scroll-container::-webkit-scrollbar-thumb {
    background: var(--primary-gold);
    border-radius: 4px;
}

.nav-scroll-container::-webkit-scrollbar-thumb:hover {
    background: var(--secondary-gold);
}

.nav-menu {
    display: flex;
    gap: 10px;
    padding: 5px;
    min-width: min-content;
}

.nav-btn {
    padding: 14px 20px;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    font-weight: bold;
    background: linear-gradient(145deg, rgba(139, 0, 0, 0.1), rgba(44, 32, 8, 0.8));
    color: var(--text-light);
    border: 2px solid var(--wood-light);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    white-space: nowrap;
    min-width: 140px;
    justify-content: center;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.nav-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
    transition: left 0.5s ease;
}

.nav-btn:hover::before {
    left: 100%;
}

.nav-btn:hover {
    background: linear-gradient(145deg, rgba(139, 0, 0, 0.3), rgba(44, 32, 8, 0.9));
    border-color: var(--primary-gold);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.nav-btn.active {
    background: linear-gradient(145deg, var(--accent-red), #6b0000);
    border-color: var(--primary-gold);
    box-shadow: 0 0 15px rgba(139, 0, 0, 0.5);
}

/* CONTEÚDO PRINCIPAL */
.main-content {
    padding: 30px 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.tab-content {
    display: none;
    animation: fadeIn 0.5s ease;
    min-height: 500px;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* PLACEHOLDER PARA CONTEÚDO */
.content-placeholder {
    text-align: center;
    padding: 80px 20px;
    color: rgba(212, 175, 55, 0.5);
    background: rgba(26, 18, 0, 0.3);
    border-radius: 12px;
    border: 2px dashed var(--wood-light);
}

.content-placeholder i {
    font-size: 4rem;
    margin-bottom: 25px;
    display: block;
    color: var(--primary-gold);
    opacity: 0.7;
}

.content-placeholder h3 {
    font-size: 1.8rem;
    margin-bottom: 15px;
    color: var(--text-gold);
    font-family: 'Uncial Antiqua', cursive;
}

.content-placeholder p {
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

/* BARRA DE AÇÕES INFERIOR */
.action-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(145deg, rgba(44, 32, 8, 0.98), rgba(26, 18, 0, 0.98));
    border-top: 3px solid var(--primary-gold);
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    z-index: 100;
    box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.3);
}

.action-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.action-btn {
    padding: 12px 25px;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    font-weight: bold;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    min-width: 160px;
    justify-content: center;
}

.action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.btn-cancelar {
    background: linear-gradient(145deg, rgba(139, 0, 0, 0.2), rgba(44, 32, 8, 0.9));
    color: var(--text-light);
    border: 2px solid var(--wood-light);
}

.btn-cancelar:hover {
    background: linear-gradient(145deg, rgba(139, 0, 0, 0.4), rgba(44, 32, 8, 1));
    border-color: var(--primary-gold);
}

.btn-salvar {
    background: linear-gradient(145deg, var(--accent-green), #1e4028);
    color: white;
    border: 2px solid #4a7c59;
}

.btn-salvar:hover {
    background: linear-gradient(145deg, #3a7c4a, #1e4028);
    border-color: #5a9c69;
}

.btn-finalizar {
    background: linear-gradient(145deg, var(--primary-gold), #b8941f);
    color: var(--primary-dark);
    border: 2px solid var(--secondary-gold);
}

.btn-finalizar:hover {
    background: linear-gradient(145deg, #e6c158, #b8941f);
    border-color: #ffd700;
}

/* NOTIFICAÇÃO */
#custom-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--secondary-dark);
    color: white;
    padding: 20px 25px;
    border-radius: 10px;
    border-left: 5px solid var(--primary-gold);
    box-shadow: var(--shadow);
    z-index: 10000;
    animation: slideIn 0.3s ease;
    font-family: 'Cinzel', serif;
    max-width: 350px;
    word-break: break-word;
    display: none;
    border: 1px solid var(--wood-light);
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}

/* RESPONSIVIDADE */
@media (max-width: 1024px) {
    .header {
        flex-direction: column;
        text-align: center;
    }
    
    .character-header {
        justify-content: center;
        width: 100%;
    }
    
    .nav-btn {
        min-width: 120px;
        padding: 12px 15px;
        font-size: 0.95rem;
    }
    
    .action-bar {
        flex-direction: column;
        gap: 15px;
    }
    
    .action-group {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .main-content {
        padding: 20px 15px;
    }
    
    .nav-scroll-container {
        padding: 5px 10px;
    }
    
    .nav-menu {
        gap: 8px;
    }
    
    .nav-btn {
        min-width: 110px;
        padding: 10px 12px;
        font-size: 0.9rem;
    }
    
    .character-name-input {
        min-width: 100%;
        order: 1;
    }
    
    .btn-voltar {
        order: 2;
        width: 100%;
        justify-content: center;
    }
    
    .action-btn {
        min-width: 140px;
        padding: 10px 20px;
    }
}

@media (max-width: 480px) {
    .nav-btn {
        min-width: 100px;
        padding: 8px 10px;
        font-size: 0.85rem;
        gap: 5px;
    }
    
    .nav-btn i {
        font-size: 0.9rem;
    }
    
    .action-btn {
        width: 100%;
        min-width: unset;
    }
    
    .content-placeholder {
        padding: 50px 15px;
    }
    
    .content-placeholder i {
        font-size: 3rem;
    }
    
    .content-placeholder h3 {
        font-size: 1.5rem;
    }
    
    #custom-toast {
        max-width: 280px;
        right: 10px;
        left: 10px;
    }
}

/* ============================================ */
/* CORREÇÃO DEFINITIVA DO SISTEMA DE ABAS      */
/* ============================================ */
.tab-content:not(.active) {
    display: none !important;
}

.tab-content.active {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
    position: relative !important;
    z-index: 1 !important;
}

.tab-content {
    animation: fadeIn 0.3s ease forwards !important;
    min-height: 500px;
}

#dashboard.tab-content.active,
#atributos.tab-content.active,
#caracteristicas.tab-content.active,
#vantagens.tab-content.active,
#pericias.tab-content.active,
#magia.tab-content.active,
#combate.tab-content.active,
#equipamento.tab-content.active,
#resumo.tab-content.active {
    display: block !important;
    opacity: 1 !important;
}

@keyframes fadeIn {
    0% { 
        opacity: 0;
        transform: translateY(10px);
    }
    100% { 
        opacity: 1 !important;
        transform: translateY(0);
    }
}

main.main-content {
    position: relative !important;
    z-index: 1 !important;
}

.tab-content {
    position: relative !important;
    z-index: 2 !important;
}

/* ============================================ */
/* ESTILOS MÍNIMOS PARA CONTAINERS DAS ABAS    */
/* (PARA NÃO QUEBRAR O LAYOUT)                 */
/* ============================================ */
.atributos-container,
.caracteristicas-container {
    background: rgba(26, 18, 0, 0.6);
    border: 2px solid var(--wood-light);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
}

/* SUBTABS (APENAS O BÁSICO) */
.subtabs-navigation {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--primary-gold);
    overflow-x: auto;
}

.subtab-btn {
    padding: 12px 20px;
    background: rgba(44, 32, 8, 0.8);
    border: 2px solid var(--wood-light);
    border-radius: 8px;
    color: var(--text-light);
    font-family: 'Cinzel', serif;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 10px;
}

.subtab-btn:hover {
    background: rgba(44, 32, 8, 1);
    border-color: var(--primary-gold);
}

.subtab-btn.active {
    background: linear-gradient(145deg, var(--accent-red), #6b0000);
    border-color: var(--primary-gold);
    color: var(--text-gold);
}

.subtabs-content {
    min-height: 600px;
}

.subtab-pane {
    display: none;
}

.subtab-pane.active {
    display: block;
}
</style>
</head>
<body>
    <!-- HEADER PRINCIPAL -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-dragon" style="color: var(--primary-gold); font-size: 1.8rem;"></i>
            <h1>FORJAR PERSONAGEM</h1>
        </div>
        
        <div class="character-header">
            <input type="text" 
                   class="character-name-input" 
                   id="characterName" 
                   placeholder="Nome do Herói" 
                   maxlength="50"
                   autocomplete="off">
            
            <button class="btn-voltar" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
        </div>
    </header>

    <!-- MENU DE ABAS - TOPO -->
    <nav class="main-nav">
        <div class="nav-scroll-container">
            <div class="nav-menu">
                <button class="nav-btn" onclick="switchTab('dashboard')" id="tabDashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn active" onclick="switchTab('atributos')" id="tabAtributos">
                    <i class="fas fa-dumbbell"></i> Atributos
                </button>
                <button class="nav-btn" onclick="switchTab('caracteristicas')" id="tabCaracteristicas">
                    <i class="fas fa-user-tag"></i> Características
                </button>
                <button class="nav-btn" onclick="switchTab('vantagens')" id="tabVantagens">
                    <i class="fas fa-star"></i> Vant/Desv
                </button>
                <button class="nav-btn" onclick="switchTab('pericias')" id="tabPericias">
                    <i class="fas fa-book-open"></i> Perícias
                </button>
                <button class="nav-btn" onclick="switchTab('magia')" id="tabMagia">
                    <i class="fas fa-hat-wizard"></i> Magia
                </button>
                <button class="nav-btn" onclick="switchTab('combate')" id="tabCombate">
                    <i class="fas fa-fist-raised"></i> Combate
                </button>
                <button class="nav-btn" onclick="switchTab('equipamento')" id="tabEquipamento">
                    <i class="fas fa-shield-alt"></i> Equipamento
                </button>
                <button class="nav-btn" onclick="switchTab('resumo')" id="tabResumo">
                    <i class="fas fa-scroll"></i> Resumo
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content">
        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-tachometer-alt"></i>
                <h3>Dashboard do Personagem</h3>
                <p>Visão geral com todos os pontos gastos, atributos principais e status do personagem.</p>
                <p style="margin-top: 20px; color: rgba(212, 175, 55, 0.7);">
                    <i class="fas fa-hammer"></i> Será implementada por último
                </p>
            </div>
        </div>
                      <!-- ATRIBUTOS -->
<div id="atributos" class="tab-content active">
    <div class="atributos-container">
        <!-- HEADER COM PONTOS -->
        <div class="atributos-header">
            <h2><i class="fas fa-dumbbell"></i> Atributos do Personagem</h2>
            <div class="card-pontos">
                <div class="ponto-total">
                    <div class="ponto-label">Pontos Gastos em Atributos</div>
                    <div id="pontosGastos" class="ponto-valor">0</div>
                </div>
            </div>
        </div>

        <!-- 4 ATRIBUTOS PRINCIPAIS -->
        <div class="atributos-principais">
            <!-- ST - FORÇA -->
            <div class="atributo-card">
                <div class="atributo-titulo">
                    <i class="fas fa-fist-raised"></i>
                    <div class="atributo-info">
                        <div class="atributo-sigla">ST</div>
                        <div class="atributo-nome">FORÇA</div>
                    </div>
                </div>
                
                <div class="atributo-valor">
                    <button class="btn-atributo menos" onclick="alterarAtributo('ST', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="ST" class="input-atributo" value="10" min="1" max="40">
                    <button class="btn-atributo mais" onclick="alterarAtributo('ST', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="atributo-custo">
                    <span>Custo:</span>
                    <span id="custoST" class="custo-valor">0</span>
                </div>
            </div>

            <!-- DX - DESTREZA -->
            <div class="atributo-card">
                <div class="atributo-titulo">
                    <i class="fas fa-running"></i>
                    <div class="atributo-info">
                        <div class="atributo-sigla">DX</div>
                        <div class="atributo-nome">DESTREZA</div>
                    </div>
                </div>
                
                <div class="atributo-valor">
                    <button class="btn-atributo menos" onclick="alterarAtributo('DX', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="DX" class="input-atributo" value="10" min="1" max="40">
                    <button class="btn-atributo mais" onclick="alterarAtributo('DX', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="atributo-custo">
                    <span>Custo:</span>
                    <span id="custoDX" class="custo-valor">0</span>
                </div>
            </div>

            <!-- IQ - INTELIGÊNCIA -->
            <div class="atributo-card">
                <div class="atributo-titulo">
                    <i class="fas fa-brain"></i>
                    <div class="atributo-info">
                        <div class="atributo-sigla">IQ</div>
                        <div class="atributo-nome">INTELIGÊNCIA</div>
                    </div>
                </div>
                
                <div class="atributo-valor">
                    <button class="btn-atributo menos" onclick="alterarAtributo('IQ', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="IQ" class="input-atributo" value="10" min="1" max="40">
                    <button class="btn-atributo mais" onclick="alterarAtributo('IQ', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="atributo-custo">
                    <span>Custo:</span>
                    <span id="custoIQ" class="custo-valor">0</span>
                </div>
            </div>

            <!-- HT - SAÚDE -->
            <div class="atributo-card">
                <div class="atributo-titulo">
                    <i class="fas fa-heart"></i>
                    <div class="atributo-info">
                        <div class="atributo-sigla">HT</div>
                        <div class="atributo-nome">SAÚDE</div>
                    </div>
                </div>
                
                <div class="atributo-valor">
                    <button class="btn-atributo menos" onclick="alterarAtributo('HT', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="HT" class="input-atributo" value="10" min="1" max="40">
                    <button class="btn-atributo mais" onclick="alterarAtributo('HT', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="atributo-custo">
                    <span>Custo:</span>
                    <span id="custoHT" class="custo-valor">0</span>
                </div>
            </div>
        </div>

        <!-- ATRIBUTOS SECUNDÁRIOS -->
        <div class="secao-titulo">
            <h3><i class="fas fa-calculator"></i> Atributos Secundários</h3>
        </div>
        
        <div class="atributos-secundarios">
            <!-- PV - Pontos de Vida -->
            <div class="secundario-card">
                <div class="secundario-header">
                    <i class="fas fa-heartbeat"></i>
                    <div class="secundario-info">
                        <div class="secundario-sigla">PV</div>
                        <div class="secundario-nome">Pontos de Vida</div>
                    </div>
                </div>
                <div class="secundario-base">Base: <span id="PVBase">10</span></div>
                
                <div class="secundario-ajuste">
                    <button class="btn-secundario menos" onclick="ajustarSecundario('PV', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="bonusPV" class="secundario-bonus" value="0" placeholder="Bônus">
                    <button class="btn-secundario mais" onclick="ajustarSecundario('PV', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="secundario-total">Total: <span id="PVTotal">10</span></div>
            </div>

            <!-- PF - Pontos de Fadiga -->
            <div class="secundario-card">
                <div class="secundario-header">
                    <i class="fas fa-wind"></i>
                    <div class="secundario-info">
                        <div class="secundario-sigla">PF</div>
                        <div class="secundario-nome">Pontos de Fadiga</div>
                    </div>
                </div>
                <div class="secundario-base">Base: <span id="PFBase">10</span></div>
                
                <div class="secundario-ajuste">
                    <button class="btn-secundario menos" onclick="ajustarSecundario('PF', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="bonusPF" class="secundario-bonus" value="0" placeholder="Bônus">
                    <button class="btn-secundario mais" onclick="ajustarSecundario('PF', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="secundario-total">Total: <span id="PFTotal">10</span></div>
            </div>

            <!-- VONTADE -->
            <div class="secundario-card">
                <div class="secundario-header">
                    <i class="fas fa-cross"></i>
                    <div class="secundario-info">
                        <div class="secundario-sigla">VON</div>
                        <div class="secundario-nome">Vontade</div>
                    </div>
                </div>
                <div class="secundario-base">Base: <span id="VontadeBase">10</span></div>
                
                <div class="secundario-ajuste">
                    <button class="btn-secundario menos" onclick="ajustarSecundario('Vontade', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="bonusVontade" class="secundario-bonus" value="0" placeholder="Bônus">
                    <button class="btn-secundario mais" onclick="ajustarSecundario('Vontade', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="secundario-total">Total: <span id="VontadeTotal">10</span></div>
            </div>

            <!-- PERCEPÇÃO -->
            <div class="secundario-card">
                <div class="secundario-header">
                    <i class="fas fa-eye"></i>
                    <div class="secundario-info">
                        <div class="secundario-sigla">PER</div>
                        <div class="secundario-nome">Percepção</div>
                    </div>
                </div>
                <div class="secundario-base">Base: <span id="PercepcaoBase">10</span></div>
                
                <div class="secundario-ajuste">
                    <button class="btn-secundario menos" onclick="ajustarSecundario('Percepcao', -1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="bonusPercepcao" class="secundario-bonus" value="0" placeholder="Bônus">
                    <button class="btn-secundario mais" onclick="ajustarSecundario('Percepcao', 1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="secundario-total">Total: <span id="PercepcaoTotal">10</span></div>
            </div>

            <!-- DESLOCAMENTO -->
            <div class="secundario-card">
                <div class="secundario-header">
                    <i class="fas fa-shoe-prints"></i>
                    <div class="secundario-info">
                        <div class="secundario-sigla">DES</div>
                        <div class="secundario-nome">Deslocamento</div>
                    </div>
                </div>
                <div class="secundario-base">Base: <span id="DeslocamentoBase">5.00</span></div>
                
                <div class="secundario-ajuste">
                    <button class="btn-secundario menos" onclick="ajustarSecundario('Deslocamento', -0.25)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="bonusDeslocamento" class="secundario-bonus" value="0" step="0.25" placeholder="Bônus">
                    <button class="btn-secundario mais" onclick="ajustarSecundario('Deslocamento', 0.25)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="secundario-total">Total: <span id="DeslocamentoTotal">5.00</span></div>
            </div>
        </div>

        <!-- TÁBUAS DE REFERÊNCIA -->
        <div class="secao-titulo">
            <h3><i class="fas fa-table"></i> Tabelas de Referência</h3>
        </div>
        
        <div class="tabelas-container">
            <div class="tabela-card">
                <div class="tabela-titulo">
                    <i class="fas fa-sword"></i>
                    <span>Dano Base (ST: <span id="currentST">10</span>)</span>
                </div>
                <div class="tabela-conteudo">
                    <div class="tabela-item">
                        <span class="tabela-label">Golpe Desarmado (GDP):</span>
                        <span id="danoGDP" class="tabela-valor">1d-2</span>
                    </div>
                    <div class="tabela-item">
                        <span class="tabela-label">Golpe com Arma (GEB):</span>
                        <span id="danoGEB" class="tabela-valor">1d</span>
                    </div>
                </div>
            </div>

            <div class="tabela-card">
                <div class="tabela-titulo">
                    <i class="fas fa-weight-hanging"></i>
                    <span>Capacidade de Carga (ST: <span id="currentST2">10</span>)</span>
                </div>
                <div class="tabela-conteudo">
                    <div class="tabela-item">
                        <span class="tabela-label">Nenhuma:</span>
                        <span id="cargaNenhuma" class="tabela-valor">10.0</span>
                    </div>
                    <div class="tabela-item">
                        <span class="tabela-label">Leve:</span>
                        <span id="cargaLeve" class="tabela-valor">20.0</span>
                    </div>
                    <div class="tabela-item">
                        <span class="tabela-label">Média:</span>
                        <span id="cargaMedia" class="tabela-valor">30.0</span>
                    </div>
                    <div class="tabela-item">
                        <span class="tabela-label">Pesada:</span>
                        <span id="cargaPesada" class="tabela-valor">60.0</span>
                    </div>
                    <div class="tabela-item">
                        <span class="tabela-label">Muito Pesada:</span>
                        <span id="cargaMuitoPesada" class="tabela-valor">100.0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- MENSAGEM DE STATUS -->
        <div id="statusAtributos" class="status-mensagem">
            <i class="fas fa-info-circle"></i>
            <span>Sistema de atributos inicializado. Ajuste os valores conforme necessário.</span>
        </div>
    </div>
</div>
                <!-- ABA CARACTERÍSTICAS -->
        <div id="caracteristicas" class="tab-content">
            <div class="caracteristicas-container">
                <!-- TABS DE NAVEGAÇÃO -->
                <div class="subtabs-navigation">
                    <button class="subtab-btn active" data-subtab="social-aparencia">
                        <i class="fas fa-user-tie"></i> Status Social & Aparência
                    </button>
                    <button class="subtab-btn" data-subtab="caracteristicas-fisicas">
                        <i class="fas fa-ruler-combined"></i> Características Físicas
                    </button>
                </div>

                <!-- CONTEÚDO DAS SUB-ABAS -->
                <div class="subtabs-content">
                    <!-- SUB-ABA 1: STATUS SOCIAL & APARÊNCIA -->
                    <div id="subtab-social-aparencia" class="subtab-pane active">
                        <!-- CARD APARÊNCIA FÍSICA -->
                        <div class="caracteristica-card">
                            <div class="card-header">
                                <i class="fas fa-user"></i>
                                <h3>Aparência Física</h3>
                                <span class="pontos-badge" id="pontosAparencia">0 pts</span>
                            </div>
                            <div class="card-content">
                                <div class="select-group">
                                    <label>Nível de Aparência:</label>
                                    <select id="nivelAparencia" class="form-select">
                                        <option value="-24">Horrendo [-24 pts]</option>
                                        <option value="-20">Monstruoso [-20 pts]</option>
                                        <option value="-16">Hediondo [-16 pts]</option>
                                        <option value="-8">Feio [-8 pts]</option>
                                        <option value="-4">Sem Atrativos [-4 pts]</option>
                                        <option value="0" selected>Comum [0 pts]</option>
                                        <option value="4">Atraente [+4 pts]</option>
                                        <option value="12">Elegante [+12 pts]</option>
                                        <option value="16">Muito Elegante [+16 pts]</option>
                                        <option value="20">Lindo [+20 pts]</option>
                                    </select>
                                </div>
                                <div class="info-display" id="displayAparencia">
                                    <strong>Comum</strong>
                                    <br><small>Reação: +0</small>
                                    <br><small>Aparência padrão, sem modificadores</small>
                                </div>
                            </div>
                        </div>

                        <!-- CARD NÍVEL DE RIQUEZA -->
                        <div class="caracteristica-card">
                            <div class="card-header">
                                <i class="fas fa-coins"></i>
                                <h3>Nível de Riqueza</h3>
                                <span class="pontos-badge" id="pontosRiqueza">0 pts</span>
                            </div>
                            <div class="card-content">
                                <div class="select-group">
                                    <label>Nível de Riqueza:</label>
                                    <select id="nivelRiqueza" class="form-select">
                                        <option value="-25">Falido [-25 pts]</option>
                                        <option value="-15">Pobre [-15 pts]</option>
                                        <option value="-10">Batalhador [-10 pts]</option>
                                        <option value="0" selected>Médio [0 pts]</option>
                                        <option value="10">Confortável [+10 pts]</option>
                                        <option value="20">Rico [+20 pts]</option>
                                        <option value="30">Muito Rico [+30 pts]</option>
                                        <option value="50">Podre de Rico [+50 pts]</option>
                                    </select>
                                </div>
                                <div class="info-display" id="displayRiqueza">
                                    <strong>Médio</strong>
                                    <br><small>Multiplicador: 1x</small>
                                    <br><small>Nível de recursos pré-definido padrão</small>
                                </div>
                                <div class="renda-info">
                                    <small>Renda Mensal Estimada: <span id="rendaMensal">$1.000</span></small>
                                </div>
                            </div>
                        </div>

                        <!-- CARD IDIOMAS -->
                        <div class="caracteristica-card full-width">
                            <div class="card-header">
                                <i class="fas fa-globe"></i>
                                <h3>Idiomas</h3>
                                <span class="pontos-badge" id="pontosIdiomas">0 pts</span>
                            </div>
                            <div class="card-content">
                                <!-- IDIOMA MATERNO -->
                                <div class="idioma-section">
                                    <h4>Idioma Materno</h4>
                                    <div class="idioma-materno">
                                        <input type="text" id="idiomaMaternoNome" value="Comum" placeholder="Nome do idioma materno" class="form-input">
                                        <span class="nivel-info">Nativo (0 pts)</span>
                                    </div>
                                </div>

                                <!-- DESVANTAGENS DE ALFABETIZAÇÃO -->
                                <div class="idioma-section">
                                    <h4>Alfabetização</h4>
                                    <div class="alfabetizacao-options">
                                        <div class="option-group">
                                            <label class="option-label">
                                                <input type="radio" name="alfabetizacao" value="0" checked>
                                                <span class="option-text">Alfabetizado (0 pts)</span>
                                            </label>
                                            <label class="option-label">
                                                <input type="radio" name="alfabetizacao" value="-2">
                                                <span class="option-text">Semianalfabeto [-2 pts]</span>
                                            </label>
                                            <label class="option-label">
                                                <input type="radio" name="alfabetizacao" value="-3">
                                                <span class="option-text">Analfabeto [-3 pts]</span>
                                            </label>
                                        </div>
                                        <div class="option-description">
                                            <small id="descAlfabetizacao">Consegue ler e escrever normalmente.</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- ADICIONAR NOVO IDIOMA -->
                                <div class="idioma-section">
                                    <h4>Adicionar Idioma</h4>
                                    <div class="add-idioma-form">
                                        <input type="text" id="novoIdiomaNome" placeholder="Digite o nome do idioma" class="form-input">
                                        
                                        <div class="niveis-container">
                                            <div class="nivel-group">
                                                <label><i class="fas fa-comment"></i> Nível de Fala:</label>
                                                <select id="novoIdiomaFala" class="form-select">
                                                    <option value="0">Nenhum (0 pts)</option>
                                                    <option value="2" selected>Rudimentar (2 pts)</option>
                                                    <option value="4">Sotaque (4 pts)</option>
                                                    <option value="6">Nativo (6 pts)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="nivel-group">
                                                <label><i class="fas fa-pen"></i> Nível de Escrita:</label>
                                                <select id="novoIdiomaEscrita" class="form-select">
                                                    <option value="0" selected>Nenhum (0 pts)</option>
                                                    <option value="2">Rudimentar (1 pt)</option>
                                                    <option value="4">Sotaque (2 pts)</option>
                                                    <option value="6">Nativo (3 pts)</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="add-idioma-actions">
                                            <span class="custo-preview">Custo: <span id="custoIdiomaPreview">+2 pts</span></span>
                                            <button id="btnAdicionarIdioma" class="btn-primary">
                                                <i class="fas fa-plus"></i> Adicionar Idioma
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- LISTA DE IDIOMAS ADICIONAIS -->
                                <div class="idioma-section">
                                    <h4>Idiomas Adicionais <small>(<span id="totalIdiomas">0</span> idiomas)</small></h4>
                                    <div id="listaIdiomasAdicionais" class="idiomas-lista">
                                        <div class="empty-state">
                                            Nenhum idioma adicional adicionado
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SUB-ABA 2: CARACTERÍSTICAS FÍSICAS -->
                    <div id="subtab-caracteristicas-fisicas" class="subtab-pane">
                        <!-- CARDS SUPERIORES -->
                        <div class="caracteristicas-grid">
                            <!-- CARD ESQUERDO: CARACTERÍSTICAS FÍSICAS -->
                            <div class="caracteristica-card">
                                <div class="card-header">
                                    <i class="fas fa-weight"></i>
                                    <h3>Características Físicas</h3>
                                    <span class="pontos-badge" id="pontosCaracteristicas">0 pts</span>
                                </div>
                                <div class="card-content">
                                    <!-- LISTA DE CARACTERÍSTICAS FÍSICAS (os 6 itens FIXOS) -->
                                    <div class="caracteristicas-lista">
                                        <!-- ITEM 1: MAGRO -->
                                        <div class="caracteristica-item" data-tipo="magro">
                                            <div class="caracteristica-info">
                                                <strong>Magro</strong>
                                                <small>-5 pts | Peso: 67% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="magro">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 2: ACIMA DO PESO -->
                                        <div class="caracteristica-item" data-tipo="acima-peso">
                                            <div class="caracteristica-info">
                                                <strong>Acima do Peso</strong>
                                                <small>-1 pt | Peso: 130% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="acima-peso">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 3: GORDO -->
                                        <div class="caracteristica-item" data-tipo="gordo">
                                            <div class="caracteristica-info">
                                                <strong>Gordo</strong>
                                                <small>-3 pts | Peso: 150% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="gordo">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 4: MUITO GORDO -->
                                        <div class="caracteristica-item" data-tipo="muito-gordo">
                                            <div class="caracteristica-info">
                                                <strong>Muito Gordo</strong>
                                                <small>-5 pts | Peso: 200% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="muito-gordo">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 5: NANISMO -->
                                        <div class="caracteristica-item" data-tipo="nanismo">
                                            <div class="caracteristica-info">
                                                <strong>Nanismo</strong>
                                                <small>-15 pts | Altura máxima: 1.32m</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="nanismo">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 6: GIGANTISMO -->
                                        <div class="caracteristica-item" data-tipo="gigantismo">
                                            <div class="caracteristica-info">
                                                <strong>Gigantismo</strong>
                                                <small>0 pts | MT +1, +1 Deslocamento</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="gigantismo">
                                                Adicionar
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- CARACTERÍSTICAS SELECIONADAS -->
                                    <div id="caracteristicasSelecionadas" class="caracteristicas-selecionadas">
                                        <!-- Dinâmico - características adicionadas aparecem aqui -->
                                    </div>
                                </div>
                            </div>

                            <!-- CARD DIREITO: ALTURA E PESO -->
                            <div class="caracteristica-card">
                                <div class="card-header">
                                    <i class="fas fa-ruler-combined"></i>
                                    <h3>Altura e Peso</h3>
                                    <span class="status-badge" id="statusFisico">Normal</span>
                                </div>
                                <div class="card-content">
                                    <!-- CONTROLES ALTURA -->
                                    <div class="fisica-control">
                                        <label><i class="fas fa-ruler-vertical"></i> Altura (metros):</label>
                                        <div class="controle-numerico">
                                            <button class="btn-controle" onclick="ajustarAltura(-0.01)">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" id="altura" value="1.70" step="0.01" min="1.20" max="2.50" class="fisica-input">
                                            <button class="btn-controle" onclick="ajustarAltura(0.01)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <div id="statusAltura" class="status-info"></div>
                                    </div>

                                    <!-- CONTROLES PESO -->
                                    <div class="fisica-control">
                                        <label><i class="fas fa-weight-scale"></i> Peso (kg):</label>
                                        <div class="controle-numerico">
                                            <button class="btn-controle" onclick="ajustarPeso(-1)">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" id="peso" value="70" step="1" min="20" max="200" class="fisica-input">
                                            <button class="btn-controle" onclick="ajustarPeso(1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <div id="statusPeso" class="status-info"></div>
                                    </div>

                                    <!-- DESVANTAGENS ATIVAS -->
                                    <div class="desvantagens-ativas" id="desvantagensAtivas" style="display: none;">
                                        <div class="desvantagens-header">
                                            <i class="fas fa-list-check"></i>
                                            <h4>Características Físicas Ativas</h4>
                                        </div>
                                        <div class="desvantagens-lista" id="listaDesvantagens">
                                            <!-- Dinâmico -->
                                        </div>
                                    </div>

                                    <!-- INFO BASE ST -->
                                    <div class="fisica-info">
                                        <div class="info-row">
                                            <span>ST Base:</span>
                                            <strong id="stBase">10</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Faixa de Altura (ST):</span>
                                            <span id="alturaFaixa">1.58m - 1.83m</span>
                                        </div>
                                        <div class="info-row">
                                            <span>Faixa de Peso (ST):</span>
                                            <span id="pesoFaixa">57.5kg - 87.5kg</span>
                                        </div>
                                        <div class="info-row">
                                            <span>Status:</span>
                                            <span id="modificadorPeso">Dentro da faixa</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CARD INFERIOR: CARACTERÍSTICAS VISUAIS (SIMPLIFICADO) -->
                        <div class="caracteristica-card full-width">
                            <div class="card-header">
                                <i class="fas fa-eye"></i>
                                <h3>Aparência Visual</h3>
                            </div>
                            <div class="card-content">
                                <div class="visual-grid">
                                    <!-- COR DA PELE -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-palette"></i> Cor da Pele:</label>
                                        <select class="form-select select-visual" data-tipo="cor-pele">
                                            <option value="Muito clara">Muito clara</option>
                                            <option value="Clara">Clara</option>
                                            <option value="Morena clara">Morena clara</option>
                                            <option value="Morena" selected>Morena</option>
                                            <option value="Morena escura">Morena escura</option>
                                            <option value="Escura">Escura</option>
                                            <option value="Muito escura">Muito escura</option>
                                        </select>
                                    </div>

                                    <!-- COR DOS OLHOS -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-eye"></i> Cor dos Olhos:</label>
                                        <select class="form-select select-visual" data-tipo="cor-olhos">
                                            <option value="Azuis">Azuis</option>
                                            <option value="Verdes">Verdes</option>
                                            <option value="Castanhos claros">Castanhos claros</option>
                                            <option value="Castanhos" selected>Castanhos</option>
                                            <option value="Castanhos escuros">Castanhos escuros</option>
                                            <option value="Pretos">Pretos</option>
                                            <option value="Vermelhos">Vermelhos</option>
                                            <option value="Âmbar">Âmbar</option>
                                        </select>
                                    </div>

                                    <!-- COR DO CABELO -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-user-hair"></i> Cor do Cabelo:</label>
                                        <select class="form-select select-visual" data-tipo="cor-cabelo">
                                            <option value="Loiro">Loiro</option>
                                            <option value="Ruivo">Ruivo</option>
                                            <option value="Castanho claro">Castanho claro</option>
                                            <option value="Castanho" selected>Castanho</option>
                                            <option value="Castanho escuro">Castanho escuro</option>
                                            <option value="Preto">Preto</option>
                                            <option value="Grisalho">Grisalho</option>
                                            <option value="Branco">Branco</option>
                                        </select>
                                    </div>

                                    <!-- TIPO DE CABELO -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-user-hair-long"></i> Tipo de Cabelo:</label>
                                        <select class="form-select select-visual" data-tipo="tipo-cabelo">
                                            <option value="Liso">Liso</option>
                                            <option value="Ondulado">Ondulado</option>
                                            <option value="Cacheado">Cacheado</option>
                                            <option value="Crespo">Crespo</option>
                                            <option value="Careca">Careca</option>
                                            <option value="Calvo">Calvo</option>
                                            <option value="Longo">Longo</option>
                                            <option value="Curto" selected>Curto</option>
                                            <option value="Médio">Médio</option>
                                        </select>
                                    </div>

                                    <!-- IDADE (campo numérico) -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-birthday-cake"></i> Idade:</label>
                                        <div class="controle-numerico">
                                            <button class="btn-controle" onclick="ajustarIdade(-1)">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" id="idade-personagem" value="25" min="12" max="100" class="fisica-input">
                                            <button class="btn-controle" onclick="ajustarIdade(1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- DESCRIÇÃO DA APARÊNCIA (automaticamente gerada) -->
                                <div class="descricao-visual">
                                    <h4><i class="fas fa-file-alt"></i> Descrição da Aparência:</h4>
                                    <div id="descricaoVisual" class="texto-descricao">
                                        25 anos, pele morena, olhos castanhos, cabelo castanho curto
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <!-- ABA VANTAGENS -->
<div id="vantagens" class="tab-content">
    <div class="caracteristicas-container">
        <!-- SUB-ABAS INTERNAS -->
        <div class="subtabs-navigation">
            <button class="subtab-btn active" data-subtab="atributos-relacoes">
                <i class="fas fa-user-cog"></i> Atributos & Relações
            </button>
            <button class="subtab-btn" data-subtab="catalogo-geral">
                <i class="fas fa-book"></i> Catálogo Geral
            </button>
        </div>

        <!-- CONTEÚDO DAS SUB-ABAS -->
        <div class="subtabs-content">
            <!-- SUB-ABA 1: ATRIBUTOS & RELAÇÕES -->
            <div id="subtab-atributos-relacoes" class="subtab-pane active">
                <!-- GRID COM 3 CARDS AGORA -->
                <div class="caracteristicas-grid">
                    <!-- CARD 1: ATRIBUTOS COMPLEMENTARES -->
                    <div class="caracteristica-card">
                        <div class="card-header">
                            <i class="fas fa-heart-plus"></i>
                            <h3>Atributos Complementares</h3>
                            <span class="pontos-badge" id="pontosAtributos">0 pts</span>
                        </div>
                        
                        <div class="card-content">
                            <!-- FORÇA DE VONTADE -->
                            <div class="atributo-item" data-tipo="forca-vontade" data-custo="5">
                                <div class="atributo-info">
                                    <div class="atributo-header">
                                        <i class="fas fa-brain"></i>
                                        <div class="atributo-detalhes">
                                            <strong>Força de Vontade</strong>
                                            <small>Custo: ±5 pts por nível</small>
                                        </div>
                                    </div>
                                    <div class="atributo-controles">
                                        <div class="botoes-direcao">
                                            <button class="btn-vantagem" data-direcao="positivo">
                                                <i class="fas fa-plus"></i> Vantagem
                                            </button>
                                            <button class="btn-desvantagem" data-direcao="negativo">
                                                <i class="fas fa-minus"></i> Desvantagem
                                            </button>
                                        </div>
                                        <div class="contador-nivel">
                                            <button class="btn-nivel menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="nivel-display">0</span>
                                            <button class="btn-nivel mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <span class="status-direcao neutro">Neutro</span>
                                        </div>
                                        <div class="custo-display">
                                            <span class="custo-label">Custo:</span>
                                            <span class="custo-valor">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- PERCEPÇÃO -->
                            <div class="atributo-item" data-tipo="percepcao" data-custo="5">
                                <div class="atributo-info">
                                    <div class="atributo-header">
                                        <i class="fas fa-eye"></i>
                                        <div class="atributo-detalhes">
                                            <strong>Percepção</strong>
                                            <small>Custo: ±5 pts por nível</small>
                                        </div>
                                    </div>
                                    <div class="atributo-controles">
                                        <div class="botoes-direcao">
                                            <button class="btn-vantagem" data-direcao="positivo">
                                                <i class="fas fa-plus"></i> Vantagem
                                            </button>
                                            <button class="btn-desvantagem" data-direcao="negativo">
                                                <i class="fas fa-minus"></i> Desvantagem
                                            </button>
                                        </div>
                                        <div class="contador-nivel">
                                            <button class="btn-nivel menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="nivel-display">0</span>
                                            <button class="btn-nivel mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <span class="status-direcao neutro">Neutro</span>
                                        </div>
                                        <div class="custo-display">
                                            <span class="custo-label">Custo:</span>
                                            <span class="custo-valor">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- PONTOS DE VIDA -->
                            <div class="atributo-item" data-tipo="pv" data-custo="2">
                                <div class="atributo-info">
                                    <div class="atributo-header">
                                        <i class="fas fa-heartbeat"></i>
                                        <div class="atributo-detalhes">
                                            <strong>Pontos de Vida</strong>
                                            <small>Custo: ±2 pts por nível</small>
                                        </div>
                                    </div>
                                    <div class="atributo-controles">
                                        <div class="botoes-direcao">
                                            <button class="btn-vantagem" data-direcao="positivo">
                                                <i class="fas fa-plus"></i> Vantagem
                                            </button>
                                            <button class="btn-desvantagem" data-direcao="negativo">
                                                <i class="fas fa-minus"></i> Desvantagem
                                            </button>
                                        </div>
                                        <div class="contador-nivel">
                                            <button class="btn-nivel menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="nivel-display">0</span>
                                            <button class="btn-nivel mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <span class="status-direcao neutro">Neutro</span>
                                        </div>
                                        <div class="custo-display">
                                            <span class="custo-label">Custo:</span>
                                            <span class="custo-valor">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- PONTOS DE FADIGA -->
                            <div class="atributo-item" data-tipo="pf" data-custo="3">
                                <div class="atributo-info">
                                    <div class="atributo-header">
                                        <i class="fas fa-wind"></i>
                                        <div class="atributo-detalhes">
                                            <strong>Pontos de Fadiga</strong>
                                            <small>Custo: ±3 pts por nível</small>
                                        </div>
                                    </div>
                                    <div class="atributo-controles">
                                        <div class="botoes-direcao">
                                            <button class="btn-vantagem" data-direcao="positivo">
                                                <i class="fas fa-plus"></i> Vantagem
                                            </button>
                                            <button class="btn-desvantagem" data-direcao="negativo">
                                                <i class="fas fa-minus"></i> Desvantagem
                                            </button>
                                        </div>
                                        <div class="contador-nivel">
                                            <button class="btn-nivel menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="nivel-display">0</span>
                                            <button class="btn-nivel mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <span class="status-direcao neutro">Neutro</span>
                                        </div>
                                        <div class="custo-display">
                                            <span class="custo-label">Custo:</span>
                                            <span class="custo-valor">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- VELOCIDADE BÁSICA -->
                            <div class="atributo-item" data-tipo="velocidade" data-custo="5" data-fator="0.25">
                                <div class="atributo-info">
                                    <div class="atributo-header">
                                        <i class="fas fa-tachometer-alt"></i>
                                        <div class="atributo-detalhes">
                                            <strong>Velocidade Básica</strong>
                                            <small>Custo: ±5 pts por 0.25</small>
                                        </div>
                                    </div>
                                    <div class="atributo-controles">
                                        <div class="botoes-direcao">
                                            <button class="btn-vantagem" data-direcao="positivo">
                                                <i class="fas fa-plus"></i> Vantagem
                                            </button>
                                            <button class="btn-desvantagem" data-direcao="negativo">
                                                <i class="fas fa-minus"></i> Desvantagem
                                            </button>
                                        </div>
                                        <div class="contador-nivel">
                                            <button class="btn-nivel menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="nivel-display">0.00</span>
                                            <button class="btn-nivel mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <span class="status-direcao neutro">Neutro</span>
                                        </div>
                                        <div class="custo-display">
                                            <span class="custo-label">Custo:</span>
                                            <span class="custo-valor">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- DESLOCAMENTO BÁSICO -->
                            <div class="atributo-item" data-tipo="deslocamento" data-custo="5" data-fator="1">
                                <div class="atributo-info">
                                    <div class="atributo-header">
                                        <i class="fas fa-running"></i>
                                        <div class="atributo-detalhes">
                                            <strong>Deslocamento Básico</strong>
                                            <small>Custo: ±5 pts por 1m</small>
                                        </div>
                                    </div>
                                    <div class="atributo-controles">
                                        <div class="botoes-direcao">
                                            <button class="btn-vantagem" data-direcao="positivo">
                                                <i class="fas fa-plus"></i> Vantagem
                                            </button>
                                            <button class="btn-desvantagem" data-direcao="negativo">
                                                <i class="fas fa-minus"></i> Desvantagem
                                            </button>
                                        </div>
                                        <div class="contador-nivel">
                                            <button class="btn-nivel menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="nivel-display">0</span>
                                            <button class="btn-nivel mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <span class="status-direcao neutro">Neutro</span>
                                        </div>
                                        <div class="custo-display">
                                            <span class="custo-label">Custo:</span>
                                            <span class="custo-valor">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CARD 2: STATUS & REPUTAÇÃO -->
                    <div class="caracteristica-card">
                        <div class="card-header">
                            <i class="fas fa-crown"></i>
                            <h3>Status & Reputação</h3>
                            <span class="pontos-badge" id="pontosStatus">0 pts</span>
                        </div>
                        
                        <div class="card-content">
                            <!-- STATUS -->
                            <div class="status-item" data-tipo="status" data-custo="5">
                                <div class="status-header">
                                    <h4><i class="fas fa-user-tie"></i> Status</h4>
                                    <small>±5 pts por nível (máx. 4 níveis)</small>
                                </div>
                                
                                <div class="status-controles">
                                    <div class="direcao-selecao">
                                        <label class="radio-label">
                                            <input type="radio" name="status-direcao" value="positivo">
                                            <span class="radio-custom"></span>
                                            <span class="radio-text">Positivo (Vantagem)</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="status-direcao" value="negativo">
                                            <span class="radio-custom"></span>
                                            <span class="radio-text">Negativo (Desvantagem)</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="status-direcao" value="neutro" checked>
                                            <span class="radio-custom"></span>
                                            <span class="radio-text">Neutro</span>
                                        </label>
                                    </div>
                                    
                                    <div class="niveis-status">
                                        <div class="nivel-contador">
                                            <button class="btn-nivel-status menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <div class="nivel-info">
                                                <span class="nivel-valor">0</span>
                                                <small>Níveis</small>
                                            </div>
                                            <button class="btn-nivel-status mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="nivel-descricao">
                                            <p id="descStatus">Status padrão, sem modificadores</p>
                                        </div>
                                    </div>
                                    
                                    <div class="status-custo">
                                        <span>Custo Total:</span>
                                        <span id="custoStatus" class="custo-total">0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- REPUTAÇÃO -->
                            <div class="status-item" data-tipo="reputacao" data-custo="5">
                                <div class="status-header">
                                    <h4><i class="fas fa-star"></i> Reputação</h4>
                                    <small>±5 pts por nível (máx. 4 níveis)</small>
                                </div>
                                
                                <div class="status-controles">
                                    <div class="direcao-selecao">
                                        <label class="radio-label">
                                            <input type="radio" name="reputacao-direcao" value="positivo">
                                            <span class="radio-custom"></span>
                                            <span class="radio-text">Positiva (Vantagem)</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="reputacao-direcao" value="negativo">
                                            <span class="radio-custom"></span>
                                            <span class="radio-text">Negativa (Desvantagem)</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="reputacao-direcao" value="neutro" checked>
                                            <span class="radio-custom"></span>
                                            <span class="radio-text">Neutra</span>
                                        </label>
                                    </div>
                                    
                                    <div class="niveis-status">
                                        <div class="nivel-contador">
                                            <button class="btn-nivel-status menos" disabled>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <div class="nivel-info">
                                                <span class="nivel-valor">0</span>
                                                <small>Níveis</small>
                                            </div>
                                            <button class="btn-nivel-status mais" disabled>
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="nivel-descricao">
                                            <p id="descReputacao">Reputação padrão, sem modificadores</p>
                                        </div>
                                    </div>
                                    
                                    <div class="status-custo">
                                        <span>Custo Total:</span>
                                        <span id="custoReputacao" class="custo-total">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CARD 3: RELACIONAMENTOS (NOVO) -->
                    <div class="caracteristica-card">
                        <div class="card-header">
                            <i class="fas fa-handshake"></i>
                            <h3>Relacionamentos</h3>
                            <span class="pontos-badge" id="pontosRelacionamentos">0 pts</span>
                        </div>
                        
                        <div class="card-content">
                            <!-- Barra de ferramentas -->
                            <div class="relacionamentos-toolbar">
                                <button id="btnAddRelacionamento" class="btn-add">
                                    <i class="fas fa-plus"></i> Adicionar Relacionamento
                                </button>
                                <div class="filter-buttons">
                                    <button class="filter-btn active" data-filter="all">Todos</button>
                                    <button class="filter-btn" data-filter="aliado">Aliados</button>
                                    <button class="filter-btn" data-filter="contato">Contatos</button>
                                    <button class="filter-btn" data-filter="inimigo">Inimigos</button>
                                    <button class="filter-btn" data-filter="patrono">Patronos</button>
                                    <button class="filter-btn" data-filter="dependente">Dependentes</button>
                                </div>
                            </div>
                            
                            <!-- Lista de relacionamentos -->
                            <div class="relacionamentos-lista" id="relacionamentosLista">
                                <!-- Dinâmico via JS -->
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <p>Nenhum relacionamento adicionado</p>
                                    <small>Clique em "Adicionar Relacionamento" para começar</small>
                                </div>
                            </div>
                            
                            <!-- Resumo rápido -->
                            <div class="relacionamentos-resumo">
                                <div class="resumo-item">
                                    <span>Aliados:</span>
                                    <span id="countAliados">0</span>
                                </div>
                                <div class="resumo-item">
                                    <span>Contatos:</span>
                                    <span id="countContatos">0</span>
                                </div>
                                <div class="resumo-item">
                                    <span>Inimigos:</span>
                                    <span id="countInimigos">0</span>
                                </div>
                                <div class="resumo-item">
                                    <span>Patronos:</span>
                                    <span id="countPatronos">0</span>
                                </div>
                                <div class="resumo-total">
                                    <span>Custo Total:</span>
                                    <span id="totalRelacionamentos">0 pts</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- RESUMO DOS PONTOS -->
                <div class="resumo-pontos">
                    <div class="resumo-card">
                        <div class="resumo-header">
                            <i class="fas fa-calculator"></i>
                            <h3>Resumo de Pontos</h3>
                        </div>
                        <div class="resumo-content">
                            <div class="resumo-item">
                                <span>Atributos Complementares:</span>
                                <span id="totalAtributos">0</span>
                            </div>
                            <div class="resumo-item">
                                <span>Status & Reputação:</span>
                                <span id="totalStatusRep">0</span>
                            </div>
                            <div class="resumo-item">
                                <span>Relacionamentos:</span>
                                <span id="totalRelacionamentosResumo">0</span>
                            </div>
                            <div class="resumo-total">
                                <span>TOTAL GASTO:</span>
                                <span id="totalGeral">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SUB-ABA 2: CATÁLOGO GERAL -->
            <div id="subtab-catalogo-geral" class="subtab-pane">
                <div class="content-placeholder">
                    <i class="fas fa-book"></i>
                    <h3>Catálogo Geral</h3>
                    <p>Sistema completo de Vantagens e Desvantagens (Físicas, Mental/Sobrenatural, Social, Supers)</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL PARA RELACIONAMENTOS -->
<div id="modalRelacionamento" class="modal">
    <div class="modal-content relacionamento-modal">
        <div class="modal-header">
            <h3><i class="fas fa-handshake"></i> Adicionar Relacionamento</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="modal-steps">
                <!-- Step 1: Tipo de Relacionamento -->
                <div class="modal-step active" id="step1">
                    <h4><i class="fas fa-user-tag"></i> Tipo de Relacionamento</h4>
                    <p>Selecione o tipo de relacionamento que deseja adicionar:</p>
                    
                    <div class="tipo-options">
                        <div class="tipo-option" data-tipo="aliado">
                            <i class="fas fa-shield-alt"></i>
                            <span>Aliado</span>
                            <small>Companheiro leal que acompanha o personagem</small>
                        </div>
                        <div class="tipo-option" data-tipo="contato">
                            <i class="fas fa-network-wired"></i>
                            <span>Contato</span>
                            <small>Fonte de informação ou influência</small>
                        </div>
                        <div class="tipo-option" data-tipo="inimigo">
                            <i class="fas fa-skull-crossbones"></i>
                            <span>Inimigo</span>
                            <small>Opositor que causa problemas</small>
                        </div>
                        <div class="tipo-option" data-tipo="patrono">
                            <i class="fas fa-crown"></i>
                            <span>Patrono</span>
                            <small>Protetor ou benfeitor poderoso</small>
                        </div>
                        <div class="tipo-option" data-tipo="dependente">
                            <i class="fas fa-heart"></i>
                            <span>Dependente</span>
                            <small>Pessoa sob proteção do personagem</small>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: Configuração (dinâmico por tipo) -->
                <div class="modal-step" id="step2">
                    <!-- Conteúdo dinâmico via JS -->
                </div>
                
                <!-- Step 3: Detalhes -->
                <div class="modal-step" id="step3">
                    <h4><i class="fas fa-edit"></i> Detalhes do Relacionamento</h4>
                    
                    <div class="form-group">
                        <label for="relNome">Nome/Descrição:</label>
                        <input type="text" id="relNome" class="form-control" 
                               placeholder="Ex: Sir Galhard, Cavaleiro Leal">
                    </div>
                    
                    <div class="form-group">
                        <label for="relDescricao">Descrição Detalhada:</label>
                        <textarea id="relDescricao" class="form-control" rows="3" 
                                  placeholder="Descreva o relacionamento, história, etc."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Observações:</label>
                        <textarea id="relObservacoes" class="form-control" rows="2" 
                                  placeholder="Notas importantes para o Mestre"></textarea>
                    </div>
                </div>
            </div>
            
            <!-- Resumo e Custo -->
            <div class="modal-resumo">
                <h4><i class="fas fa-calculator"></i> Resumo</h4>
                <div class="resumo-info">
                    <div class="resumo-item">
                        <span>Tipo:</span>
                        <span id="resumoTipo">-</span>
                    </div>
                    <div class="resumo-item">
                        <span>Custo Base:</span>
                        <span id="resumoCustoBase">0 pts</span>
                    </div>
                    <div class="resumo-item">
                        <span>Modificadores:</span>
                        <span id="resumoMods">+0 pts</span>
                    </div>
                    <div class="resumo-total">
                        <span>Custo Total:</span>
                        <span id="resumoTotal">0 pts</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-prev" id="btnPrev">
                <i class="fas fa-arrow-left"></i> Anterior
            </button>
            <button class="btn-next" id="btnNext">
                Próximo <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn-save" id="btnSave">
                <i class="fas fa-save"></i> Salvar Relacionamento
            </button>
        </div>
    </div>
</div>
                <!-- PERÍCIAS -->
        <div id="pericias" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-book-open"></i>
                <h3>Perícias e Técnicas</h3>
                <p>Adicione e gerencie todas as perícias, habilidades e técnicas.</p>
            </div>
        </div>

        <!-- MAGIA -->
        <div id="magia" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-hat-wizard"></i>
                <h3>Sistema Mágico</h3>
                <p>Configure magias, poderes, mana e habilidades sobrenaturais.</p>
            </div>
        </div>

        <!-- COMBATE -->
        <div id="combate" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-fist-raised"></i>
                <h3>Proezas de Combate</h3>
                <p>Defina armas, defesas, manobras e táticas de combate.</p>
            </div>
        </div>

        <!-- EQUIPAMENTO -->
        <div id="equipamento" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-shield-alt"></i>
                <h3>Inventário</h3>
                <p>Gerencie equipamentos, itens, riqueza e carga do personagem.</p>
            </div>
        </div>

        <!-- RESUMO -->
        <div id="resumo" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-scroll"></i>
                <h3>Ficha Completa</h3>
                <p>Visualização final e exportação da ficha do personagem.</p>
            </div>
        </div>
    </main>

    <!-- BARRA DE AÇÕES -->
    <div class="action-bar">
        <div class="action-group">
            <button class="action-btn btn-cancelar" onclick="cancelCreation()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="action-btn btn-cancelar" onclick="resetCharacter()">
                <i class="fas fa-redo"></i> Limpar Tudo
            </button>
        </div>
        
        <div class="action-group">
            <button class="action-btn btn-salvar" onclick="saveDraft()">
                <i class="fas fa-save"></i> Salvar Rascunho
            </button>
            <button class="action-btn btn-finalizar" onclick="finalizeCharacter()">
                <i class="fas fa-check-double"></i> Finalizar Personagem
            </button>
        </div>
    </div>

    <!-- NOTIFICAÇÃO -->
    <div id="custom-toast"></div>
     
    <script src="atributos.js"></script>
    <script src="caracteristicas-main.js"></script>
    <script src="caracteristicas-fisicas.js"></script>
    <script src="caracteristicas-aparencia.js"></script>
    <script src="caracteristicas-riqueza.js"></script>
    <script src="caracteristicas-idiomas.js"></script>
    <script src="vantagens-main.js"></script>
    <script src="vantagens-atributos.js"></script>
    <script src="relacionamentos.js"></script>
    <script>
    // ===========================================
    // INICIALIZAÇÃO FIREBASE
    // ===========================================
    let app, auth, db;
    let currentCharacterId = null;
    let currentUser = null;
    let isInitialized = false;

    if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
        app = firebase.app();
        auth = firebase.auth();
        db = firebase.firestore();
    } else {
        const firebaseConfig = {
            apiKey: "AIzaSyBoTP0oJH4q3yrc0N8sCv9ynKN53dN-UbU",
            authDomain: "gurpsroll.firebaseapp.com",
            projectId: "gurpsroll"
        };
        app = firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
    }

    // ===========================================
    // VERIFICAÇÃO DE AUTENTICAÇÃO
    // ===========================================
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            console.log('✅ Usuário autenticado:', user.uid);
            loadCharacterData();
            isInitialized = true;
        } else {
            console.log('❌ Usuário não autenticado');
            showToast('🔒 Faça login para criar personagens', 'error');
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1500);
        }
    });

    // ===========================================
    // SISTEMA DE ABAS
    // ===========================================
    function switchTab(tabId) {
        if (!isInitialized) return;
        
        // Remove active de todas as abas e botões
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        // Ativa a aba selecionada
        const tabElement = document.getElementById(tabId);
        if (tabElement) {
            tabElement.classList.add('active');
        }

        // Ativa o botão correspondente
        const tabBtn = document.getElementById(`tab${capitalizeFirstLetter(tabId)}`);
        if (tabBtn) {
            tabBtn.classList.add('active');
        }

        // Salva a última aba acessada
        localStorage.setItem('lastTab', tabId);
        
        // Rola para o topo
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Dispara evento para inicialização específica da aba
        if (typeof window[`init${capitalizeFirstLetter(tabId)}Tab`] === 'function') {
            window[`init${capitalizeFirstLetter(tabId)}Tab`]();
        }
    }

    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // ===========================================
    // CARREGAR DADOS DO PERSONAGEM
    // ===========================================
    async function loadCharacterData() {
        // Verifica se tem ID de personagem na URL
        const urlParams = new URLSearchParams(window.location.search);
        const charId = urlParams.get('id');

        if (charId) {
            // CARREGAR PERSONAGEM EXISTENTE
            try {
                const charDoc = await db.collection('characters').doc(charId).get();
                
                if (charDoc.exists && charDoc.data().owner === currentUser.uid) {
                    currentCharacterId = charId;
                    const charData = charDoc.data();
                    
                    // Preenche dados básicos
                    document.getElementById('characterName').value = charData.name || '';
                    
                    showToast('📜 Personagem carregado: ' + charData.name, 'success');
                    
                    // Carrega última aba acessada
                    const lastTab = charData.lastTab || 'atributos';
                    setTimeout(() => switchTab(lastTab), 100);
                } else {
                    showToast('❌ Personagem não encontrado ou acesso negado', 'error');
                    currentCharacterId = null;
                    switchTab('atributos');
                }
            } catch (error) {
                console.error('Erro ao carregar personagem:', error);
                showToast('❌ Erro ao carregar personagem', 'error');
                switchTab('atributos');
            }
        } else {
            // NOVO PERSONAGEM
            currentCharacterId = null;
            document.getElementById('characterName').value = '';
            
            // Restaura última aba acessada ou vai para atributos
            const lastTab = localStorage.getItem('lastTab') || 'atributos';
            setTimeout(() => switchTab(lastTab), 100);
        }
    }

    // ===========================================
    // SALVAR RASCUNHO
    // ===========================================
    async function saveDraft() {
        if (!currentUser) {
            showToast('❌ Faça login para salvar', 'error');
            return;
        }

        const characterName = document.getElementById('characterName').value.trim();
        if (!characterName) {
            showToast('⚠️ Digite um nome para o personagem', 'warning');
            document.getElementById('characterName').focus();
            return;
        }

        const characterData = {
            name: characterName,
            owner: currentUser.uid,
            lastTab: localStorage.getItem('lastTab') || 'atributos',
            lastUpdated: new Date().toISOString(),
            status: 'draft'
        };

        try {
            if (currentCharacterId) {
                // Atualiza personagem existente
                await db.collection('characters').doc(currentCharacterId).update(characterData);
                showToast('💾 Rascunho atualizado', 'success');
            } else {
                // Cria novo personagem
                const docRef = await db.collection('characters').add({
                    ...characterData,
                    createdAt: new Date().toISOString()
                });
                currentCharacterId = docRef.id;
                
                // Atualiza URL com o ID
                window.history.replaceState({}, '', `?id=${currentCharacterId}`);
                showToast('✅ Personagem criado e salvo', 'success');
            }
        } catch (error) {
            console.error('Erro ao salvar:', error);
            showToast('❌ Erro ao salvar personagem', 'error');
        }
    }

    // ===========================================
    // FINALIZAR PERSONAGEM
    // ===========================================
    async function finalizeCharacter() {
        if (!currentUser) {
            showToast('❌ Faça login para finalizar', 'error');
            return;
        }

        const characterName = document.getElementById('characterName').value.trim();
        if (!characterName) {
            showToast('⚠️ Digite um nome para o personagem', 'warning');
            return;
        }

        showToast('🎉 Personagem finalizado com sucesso!', 'success');
        
        // Redireciona para a página do personagem após 2 segundos
        setTimeout(() => {
            window.location.href = 'modo-personagem.html';
        }, 2000);
    }

    // ===========================================
    // FUNÇÕES AUXILIARES
    // ===========================================
    function goBack() {
        window.location.href = 'modo-personagem.html';
    }

    function cancelCreation() {
        if (confirm('Tem certeza que deseja cancelar? Todo progresso não salvo será perdido.')) {
            window.location.href = 'modo-personagem.html';
        }
    }

    function resetCharacter() {
        if (confirm('Isso vai limpar TODOS os dados do personagem. Continuar?')) {
            document.getElementById('characterName').value = '';
            currentCharacterId = null;
            localStorage.removeItem('lastTab');
            showToast('🔄 Personagem resetado', 'info');
            switchTab('atributos');
        }
    }

    function showToast(message, type = 'info') {
        const toast = document.getElementById('custom-toast');
        toast.innerHTML = `<i class="fas fa-${getToastIcon(type)}"></i> ${message}`;
        toast.style.display = 'block';
        
        const bgColor = type === 'error' ? 'var(--accent-red)' : 
                       type === 'success' ? 'var(--accent-green)' : 
                       type === 'warning' ? 'var(--primary-gold)' : 
                       'var(--secondary-dark)';
        
        toast.style.background = bgColor;
        toast.style.animation = 'slideIn 0.3s ease';
        
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 300);
        }, 3000);
    }

    function getToastIcon(type) {
        switch(type) {
            case 'success': return 'check-circle';
            case 'error': return 'exclamation-circle';
            case 'warning': return 'exclamation-triangle';
            default: return 'info-circle';
        }
    }

    // ===========================================
    // AUTO-SAVE A CADA 30 SEGUNDOS
    // ===========================================
    let autoSaveTimer;
    document.getElementById('characterName').addEventListener('input', () => {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(() => {
            if (currentCharacterId && isInitialized) {
                saveDraft();
            }
        }, 30000);
    });

    // ===========================================
    // FUNÇÕES PARA INICIALIZAÇÃO DAS ABAS
    // ===========================================
    window.initAtributosTab = function() {
        console.log('⚔️ Inicializando aba de Atributos...');
        // Esta função será chamada pelo atributos.js
        if (typeof window.inicializarAtributos === 'function') {
            window.inicializarAtributos();
        }
    };

    window.initCaracteristicasTab = function() {
        console.log('👤 Inicializando aba de Características...');
        // Esta função será chamada pelo caracteristicas-main.js
        if (typeof window.iniciarSistemaCaracteristicas === 'function') {
            window.iniciarSistemaCaracteristicas();
        }
    };

    window.initVantagensTab = function() {
        console.log('⭐ Inicializando aba de Vantagens...');
        // Esta função será chamada pelo vantagens-main.js
        if (typeof window.iniciarSistemaVantagens === 'function') {
            window.iniciarSistemaVantagens();
        }
    };

    // ===========================================
    // INICIALIZAÇÃO GERAL
    // ===========================================
    document.addEventListener('DOMContentLoaded', () => {
        console.log('🏰 Editor de Personagem GURPS carregado');
        
        // Adiciona classe para animação de entrada
        document.body.style.opacity = '0';
        setTimeout(() => {
            document.body.style.transition = 'opacity 0.5s ease';
            document.body.style.opacity = '1';
        }, 100);
        
        // Inicializa sistemas específicos se as abas correspondentes estiverem ativas
        setTimeout(() => {
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                const tabId = activeTab.id;
                if (typeof window[`init${capitalizeFirstLetter(tabId)}Tab`] === 'function') {
                    window[`init${capitalizeFirstLetter(tabId)}Tab`]();
                }
            }
        }, 500);
    });
</script>
</body>
</html>