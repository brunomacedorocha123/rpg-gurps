<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Personagem - GURPS Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@400;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style-atributos.css">
    <link rel="stylesheet" href="style-caracteristicas.css">
    <link rel="stylesheet" href="style-vantagens.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-dark: #1a1200;
            --secondary-dark: #2c2008;
            --primary-gold: #d4af37;
            --secondary-gold: #f4d03f;
            --accent-red: #8b0000;
            --accent-green: #2e5c3a;
            --text-light: #f5f5dc;
            --text-gold: #ffd700;
            --parchment: #f7f3e9;
            --wood-dark: #5d4037;
            --wood-light: #8d6e63;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Cinzel', serif;
            background-color: var(--primary-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(44, 32, 8, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(42, 21, 11, 0.5) 0%, transparent 20%);
            color: var(--text-light);
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M0,0 L100,0 L100,100 L0,100 Z" fill="none" stroke="%232c2008" stroke-width="0.5"/></svg>'),
                linear-gradient(0deg, transparent 24%, rgba(139, 0, 0, 0.05) 25%, rgba(139, 0, 0, 0.05) 26%, transparent 27%, transparent 74%, rgba(139, 0, 0, 0.05) 75%, rgba(139, 0, 0, 0.05) 76%, transparent 77%, transparent);
            background-size: 50px 50px, 10px 10px;
            opacity: 0.3;
            z-index: -1;
        }

        /* HEADER PRINCIPAL */
        .header {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.95), rgba(26, 18, 0, 0.95));
            border-bottom: 3px solid var(--primary-gold);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo h1 {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 1.8rem;
            color: var(--text-gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .character-header {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .character-name-input {
            background: rgba(212, 175, 55, 0.15);
            border: 2px solid var(--primary-gold);
            border-radius: 8px;
            padding: 10px 20px;
            color: var(--text-gold);
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            min-width: 250px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .character-name-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
            transform: scale(1.02);
        }

        .character-name-input::placeholder {
            color: rgba(212, 175, 55, 0.6);
        }

        .btn-voltar {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.1), rgba(44, 32, 8, 0.8));
            color: var(--text-light);
            border: 2px solid var(--wood-light);
            border-radius: 8px;
            padding: 10px 20px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-voltar:hover {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.3), rgba(44, 32, 8, 0.9));
            border-color: var(--primary-gold);
            transform: translateY(-2px);
        }

        /* MENU DE ABAS - TOPO (COMO NA HOME) */
        .main-nav {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.95), rgba(26, 18, 0, 0.95));
            border-bottom: 2px solid var(--wood-dark);
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .nav-scroll-container {
            overflow-x: auto;
            padding: 5px 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-gold) var(--secondary-dark);
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .nav-scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .nav-scroll-container::-webkit-scrollbar-track {
            background: var(--secondary-dark);
            border-radius: 4px;
        }

        .nav-scroll-container::-webkit-scrollbar-thumb {
            background: var(--primary-gold);
            border-radius: 4px;
        }

        .nav-scroll-container::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-gold);
        }

        .nav-menu {
            display: flex;
            gap: 10px;
            padding: 5px;
            min-width: min-content;
        }

        .nav-btn {
            padding: 14px 20px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: bold;
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.1), rgba(44, 32, 8, 0.8));
            color: var(--text-light);
            border: 2px solid var(--wood-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            min-width: 140px;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.3), rgba(44, 32, 8, 0.9));
            border-color: var(--primary-gold);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: linear-gradient(145deg, var(--accent-red), #6b0000);
            border-color: var(--primary-gold);
            box-shadow: 0 0 15px rgba(139, 0, 0, 0.5);
        }

        /* CONTEÚDO PRINCIPAL */
        .main-content {
            padding: 30px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* PLACEHOLDER PARA CONTEÚDO */
        .content-placeholder {
            text-align: center;
            padding: 80px 20px;
            color: rgba(212, 175, 55, 0.5);
            background: rgba(26, 18, 0, 0.3);
            border-radius: 12px;
            border: 2px dashed var(--wood-light);
        }

        .content-placeholder i {
            font-size: 4rem;
            margin-bottom: 25px;
            display: block;
            color: var(--primary-gold);
            opacity: 0.7;
        }

        .content-placeholder h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--text-gold);
            font-family: 'Uncial Antiqua', cursive;
        }

        .content-placeholder p {
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* BARRA DE AÇÕES INFERIOR */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.98), rgba(26, 18, 0, 0.98));
            border-top: 3px solid var(--primary-gold);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            z-index: 100;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.3);
        }

        .action-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 25px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 160px;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-cancelar {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.2), rgba(44, 32, 8, 0.9));
            color: var(--text-light);
            border: 2px solid var(--wood-light);
        }

        .btn-cancelar:hover {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.4), rgba(44, 32, 8, 1));
            border-color: var(--primary-gold);
        }

        .btn-salvar {
            background: linear-gradient(145deg, var(--accent-green), #1e4028);
            color: white;
            border: 2px solid #4a7c59;
        }

        .btn-salvar:hover {
            background: linear-gradient(145deg, #3a7c4a, #1e4028);
            border-color: #5a9c69;
        }

        .btn-finalizar {
            background: linear-gradient(145deg, var(--primary-gold), #b8941f);
            color: var(--primary-dark);
            border: 2px solid var(--secondary-gold);
        }

        .btn-finalizar:hover {
            background: linear-gradient(145deg, #e6c158, #b8941f);
            border-color: #ffd700;
        }

        /* NOTIFICAÇÃO */
        #custom-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary-dark);
            color: white;
            padding: 20px 25px;
            border-radius: 10px;
            border-left: 5px solid var(--primary-gold);
            box-shadow: var(--shadow);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            font-family: 'Cinzel', serif;
            max-width: 350px;
            word-break: break-word;
            display: none;
            border: 1px solid var(--wood-light);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* RESPONSIVIDADE */
        @media (max-width: 1024px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .character-header {
                justify-content: center;
                width: 100%;
            }
            
            .nav-btn {
                min-width: 120px;
                padding: 12px 15px;
                font-size: 0.95rem;
            }
            
            .action-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .action-group {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px 15px;
            }
            
            .nav-scroll-container {
                padding: 5px 10px;
            }
            
            .nav-menu {
                gap: 8px;
            }
            
            .nav-btn {
                min-width: 110px;
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .character-name-input {
                min-width: 100%;
                order: 1;
            }
            
            .btn-voltar {
                order: 2;
                width: 100%;
                justify-content: center;
            }
            
            .action-btn {
                min-width: 140px;
                padding: 10px 20px;
            }
        }

        @media (max-width: 480px) {
            .nav-btn {
                min-width: 100px;
                padding: 8px 10px;
                font-size: 0.85rem;
                gap: 5px;
            }
            
            .nav-btn i {
                font-size: 0.9rem;
            }
            
            .action-btn {
                width: 100%;
                min-width: unset;
            }
            
            .content-placeholder {
                padding: 50px 15px;
            }
            
            .content-placeholder i {
                font-size: 3rem;
            }
            
            .content-placeholder h3 {
                font-size: 1.5rem;
            }
            
            #custom-toast {
                max-width: 280px;
                right: 10px;
                left: 10px;
            }
        }

        /* ============================================ */
        /* CORREÇÃO DEFINITIVA DO SISTEMA DE ABAS      */
        /* ============================================ */
        .tab-content:not(.active) {
            display: none !important;
        }

        .tab-content.active {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            position: relative !important;
            z-index: 1 !important;
        }

        .tab-content {
            animation: fadeIn 0.3s ease forwards !important;
            min-height: 500px;
        }

        #dashboard.tab-content.active,
        #atributos.tab-content.active,
        #caracteristicas.tab-content.active,
        #vantagens.tab-content.active,
        #pericias.tab-content.active,
        #magia.tab-content.active,
        #combate.tab-content.active,
        #equipamento.tab-content.active,
        #resumo.tab-content.active {
            display: block !important;
            opacity: 1 !important;
        }

        @keyframes fadeIn {
            0% { 
                opacity: 0;
                transform: translateY(10px);
            }
            100% { 
                opacity: 1 !important;
                transform: translateY(0);
            }
        }

        main.main-content {
            position: relative !important;
            z-index: 1 !important;
        }

        .tab-content {
            position: relative !important;
            z-index: 2 !important;
        }

        /* ESTILOS DA ABA ATRIBUTOS */
        .atributos-container {
            background: rgba(26, 18, 0, 0.6);
            border: 2px solid var(--wood-light);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .atributos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-gold);
        }

        .atributos-header h2 {
            color: var(--text-gold);
            font-family: 'Uncial Antiqua', cursive;
            font-size: 1.8rem;
        }

        .card-pontos {
            background: rgba(44, 32, 8, 0.8);
            border: 2px solid var(--primary-gold);
            border-radius: 8px;
            padding: 15px 25px;
        }

        .ponto-total {
            text-align: center;
        }

        .ponto-label {
            font-size: 0.9rem;
            color: rgba(212, 175, 55, 0.8);
            margin-bottom: 5px;
        }

        .ponto-valor {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .atributos-principais {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .atributo-card {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.9), rgba(26, 18, 0, 0.9));
            border: 2px solid var(--wood-light);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .atributo-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .atributo-titulo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .atributo-titulo i {
            font-size: 2rem;
            color: var(--primary-gold);
        }

        .atributo-info {
            flex-grow: 1;
        }

        .atributo-sigla {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text-gold);
        }

        .atributo-nome {
            font-size: 0.9rem;
            color: rgba(245, 245, 220, 0.7);
        }

        .atributo-valor {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .btn-atributo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--wood-light);
            background: rgba(26, 18, 0, 0.8);
            color: var(--text-light);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-atributo:hover {
            border-color: var(--primary-gold);
            background: rgba(212, 175, 55, 0.2);
            transform: scale(1.1);
        }

        .input-atributo {
            width: 80px;
            height: 60px;
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            background: rgba(26, 18, 0, 0.5);
            border: 2px solid var(--primary-gold);
            border-radius: 8px;
            color: var(--text-gold);
            font-family: 'Cinzel', serif;
        }

        .input-atributo:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .atributo-custo {
            text-align: center;
            padding-top: 10px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            font-size: 0.9rem;
            color: rgba(245, 245, 220, 0.7);
        }

        .custo-valor {
            font-weight: bold;
            color: var(--secondary-gold);
            margin-left: 5px;
        }

        .secao-titulo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-gold);
        }

        .secao-titulo h3 {
            color: var(--text-gold);
            font-family: 'Uncial Antiqua', cursive;
            font-size: 1.5rem;
        }

        .atributos-secundarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .secundario-card {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.8), rgba(26, 18, 0, 0.8));
            border: 2px solid var(--wood-light);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .secundario-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-3px);
        }

        .secundario-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .secundario-header i {
            color: var(--primary-gold);
            font-size: 1.2rem;
        }

        .secundario-info {
            flex-grow: 1;
        }

        .secundario-sigla {
            font-weight: bold;
            color: var(--text-gold);
        }

        .secundario-nome {
            font-size: 0.8rem;
            color: rgba(245, 245, 220, 0.7);
        }

        .secundario-base {
            font-size: 0.85rem;
            color: rgba(245, 245, 220, 0.6);
            margin-bottom: 10px;
        }

        .secundario-ajuste {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-secundario {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--wood-light);
            background: rgba(26, 18, 0, 0.8);
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-secundario:hover {
            border-color: var(--primary-gold);
            background: rgba(212, 175, 55, 0.2);
        }

        .secundario-bonus {
            flex-grow: 1;
            text-align: center;
            background: rgba(26, 18, 0, 0.5);
            border: 1px solid var(--wood-light);
            border-radius: 4px;
            padding: 5px;
            color: var(--text-gold);
        }

        .secundario-total {
            text-align: center;
            font-weight: bold;
            color: var(--text-gold);
            padding-top: 10px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .tabelas-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .tabela-card {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.9), rgba(26, 18, 0, 0.9));
            border: 2px solid var(--wood-light);
            border-radius: 10px;
            padding: 20px;
        }

        .tabela-titulo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        .tabela-titulo i {
            color: var(--primary-gold);
        }

        .tabela-titulo span {
            color: var(--text-gold);
            font-weight: bold;
        }

        .tabela-conteudo {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tabela-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(139, 0, 0, 0.2);
        }

        .tabela-label {
            color: rgba(245, 245, 220, 0.8);
            font-size: 0.9rem;
        }

        .tabela-valor {
            font-weight: bold;
            color: var(--secondary-gold);
        }

        .status-mensagem {
            background: rgba(44, 32, 8, 0.8);
            border: 2px solid var(--primary-gold);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .status-mensagem i {
            color: var(--primary-gold);
            font-size: 1.2rem;
        }

        .status-mensagem span {
            color: var(--text-light);
        }

        /* ESTILOS PARA ABA CARACTERÍSTICAS */
        .caracteristicas-container {
            background: rgba(26, 18, 0, 0.6);
            border: 2px solid var(--wood-light);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .subtabs-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-gold);
            overflow-x: auto;
        }

        .subtab-btn {
            padding: 12px 20px;
            background: rgba(44, 32, 8, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 8px;
            color: var(--text-light);
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subtab-btn:hover {
            background: rgba(44, 32, 8, 1);
            border-color: var(--primary-gold);
        }

        .subtab-btn.active {
            background: linear-gradient(145deg, var(--accent-red), #6b0000);
            border-color: var(--primary-gold);
            color: var(--text-gold);
        }

        .subtabs-content {
            min-height: 600px;
        }

        .subtab-pane {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .subtab-pane.active {
            display: block;
        }

        .caracteristicas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .caracteristica-card {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.9), rgba(26, 18, 0, 0.9));
            border: 2px solid var(--wood-light);
            border-radius: 10px;
            overflow: hidden;
        }

        .caracteristica-card.full-width {
            grid-column: 1 / -1;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(44, 32, 8, 0.95);
            border-bottom: 2px solid var(--primary-gold);
        }

        .card-header i {
            color: var(--primary-gold);
            font-size: 1.5rem;
        }

        .card-header h3 {
            color: var(--text-gold);
            font-family: 'Uncial Antiqua', cursive;
            font-size: 1.3rem;
            flex-grow: 1;
        }

        .pontos-badge {
            background: var(--primary-gold);
            color: var(--primary-dark);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .card-content {
            padding: 20px;
        }

        .select-group {
            margin-bottom: 15px;
        }

        .select-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-gold);
            font-weight: bold;
        }

        .form-select {
            width: 100%;
            padding: 10px 15px;
            background: rgba(26, 18, 0, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 6px;
            color: var(--text-light);
            font-family: 'Cinzel', serif;
            font-size: 1rem;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-gold);
        }

        .info-display {
            background: rgba(26, 18, 0, 0.5);
            border: 1px solid var(--wood-light);
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
        }

        .info-display strong {
            color: var(--text-gold);
            font-size: 1.1rem;
        }

        .info-display small {
            color: rgba(245, 245, 220, 0.7);
            display: block;
            margin-top: 5px;
        }

        .renda-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .renda-info small {
            color: var(--primary-gold);
        }

        .idioma-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .idioma-section:last-child {
            border-bottom: none;
        }

        .idioma-section h4 {
            color: var(--text-gold);
            margin-bottom: 15px;
            font-family: 'Uncial Antiqua', cursive;
        }

        .idioma-materno {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-input {
            flex-grow: 1;
            padding: 10px 15px;
            background: rgba(26, 18, 0, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 6px;
            color: var(--text-light);
            font-family: 'Cinzel', serif;
        }

        .nivel-info {
            color: var(--primary-gold);
            font-weight: bold;
            white-space: nowrap;
        }

        .alfabetizacao-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .option-label input {
            accent-color: var(--primary-gold);
        }

        .option-text {
            color: var(--text-light);
        }

        .option-description {
            margin-top: 10px;
            padding: 10px;
            background: rgba(26, 18, 0, 0.5);
            border-radius: 6px;
            border-left: 3px solid var(--primary-gold);
        }

        .add-idioma-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .niveis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .nivel-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-gold);
        }

        .add-idioma-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .custo-preview {
            color: var(--primary-gold);
            font-weight: bold;
        }

        .btn-primary {
            padding: 10px 20px;
            background: linear-gradient(145deg, var(--accent-green), #1e4028);
            color: white;
            border: none;
            border-radius: 6px;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary:hover {
            background: linear-gradient(145deg, #3a7c4a, #1e4028);
            transform: translateY(-2px);
        }

        .idiomas-lista {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(26, 18, 0, 0.5);
            border-radius: 6px;
        }

        .empty-state {
            text-align: center;
            color: rgba(212, 175, 55, 0.5);
            padding: 20px;
            font-style: italic;
        }

        .caracteristicas-lista {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .caracteristica-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(44, 32, 8, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .caracteristica-item:hover {
            border-color: var(--primary-gold);
            transform: translateX(5px);
        }

        .caracteristica-info strong {
            color: var(--text-gold);
        }

        .caracteristica-info small {
            color: rgba(245, 245, 220, 0.7);
            display: block;
            margin-top: 5px;
        }

        .btn-add-caracteristica {
            padding: 8px 15px;
            background: var(--primary-gold);
            color: var(--primary-dark);
            border: none;
            border-radius: 4px;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add-caracteristica:hover {
            background: var(--secondary-gold);
            transform: scale(1.05);
        }

        .caracteristicas-selecionadas {
            margin-top: 20px;
            padding: 15px;
            background: rgba(26, 18, 0, 0.5);
            border-radius: 6px;
            border: 1px dashed var(--wood-light);
            min-height: 60px;
        }

        .fisica-control {
            margin-bottom: 20px;
        }

        .fisica-control label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-gold);
            font-weight: bold;
        }

        .controle-numerico {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-controle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--wood-light);
            background: rgba(26, 18, 0, 0.8);
            color: var(--text-light);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-controle:hover {
            border-color: var(--primary-gold);
            background: rgba(212, 175, 55, 0.2);
        }

        .fisica-input {
            flex-grow: 1;
            text-align: center;
            padding: 10px;
            background: rgba(26, 18, 0, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 6px;
            color: var(--text-gold);
            font-size: 1.2rem;
            font-family: 'Cinzel', serif;
        }

        .status-info {
            margin-top: 5px;
            font-size: 0.9rem;
            color: rgba(212, 175, 55, 0.8);
        }

        .desvantagens-ativas {
            margin: 20px 0;
            padding: 15px;
            background: rgba(139, 0, 0, 0.1);
            border: 2px solid var(--accent-red);
            border-radius: 8px;
        }

        .desvantagens-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .desvantagens-header i {
            color: var(--accent-red);
        }

        .desvantagens-header h4 {
            color: var(--text-gold);
        }

        .desvantagens-lista {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fisica-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(26, 18, 0, 0.5);
            border-radius: 6px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .visual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .visual-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .visual-group label {
            color: var(--text-gold);
            font-weight: bold;
        }

        .select-visual {
            padding: 10px;
            background: rgba(26, 18, 0, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 6px;
            color: var(--text-light);
            font-family: 'Cinzel', serif;
        }

        .descricao-visual {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid var(--primary-gold);
        }

        .descricao-visual h4 {
            color: var(--text-gold);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .texto-descricao {
            background: rgba(26, 18, 0, 0.5);
            border: 1px solid var(--wood-light);
            border-radius: 6px;
            padding: 15px;
            color: var(--text-light);
            line-height: 1.6;
        }

        /* ESTILOS PARA ABA VANTAGENS */
        .atributo-item {
            background: rgba(44, 32, 8, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .atributo-item:hover {
            border-color: var(--primary-gold);
        }

        .atributo-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .atributo-header i {
            color: var(--primary-gold);
            font-size: 1.5rem;
        }

        .atributo-detalhes strong {
            color: var(--text-gold);
            font-size: 1.1rem;
        }

        .atributo-detalhes small {
            color: rgba(245, 245, 220, 0.7);
            font-size: 0.85rem;
        }

        .atributo-controles {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .botoes-direcao {
            display: flex;
            gap: 10px;
        }

        .btn-vantagem {
            padding: 8px 15px;
            background: linear-gradient(145deg, var(--accent-green), #1e4028);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-vantagem:hover {
            background: linear-gradient(145deg, #3a7c4a, #1e4028);
            transform: translateY(-2px);
        }

        .btn-desvantagem {
            padding: 8px 15px;
            background: linear-gradient(145deg, var(--accent-red), #6b0000);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-desvantagem:hover {
            background: linear-gradient(145deg, #9b0000, #6b0000);
            transform: translateY(-2px);
        }

        .contador-nivel {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
        }

        .btn-nivel {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid var(--wood-light);
            background: rgba(26, 18, 0, 0.8);
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-nivel:hover:not(:disabled) {
            border-color: var(--primary-gold);
            background: rgba(212, 175, 55, 0.2);
        }

        .btn-nivel:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nivel-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-gold);
            min-width: 40px;
            text-align: center;
        }

        .status-direcao {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-direcao.positivo {
            background: rgba(46, 92, 58, 0.3);
            color: #4CAF50;
            border: 1px solid #4CAF50;
        }

        .status-direcao.negativo {
            background: rgba(139, 0, 0, 0.3);
            color: #f44336;
            border: 1px solid #f44336;
        }

        .status-direcao.neutro {
            background: rgba(212, 175, 55, 0.1);
            color: var(--primary-gold);
            border: 1px solid var(--primary-gold);
        }

        .custo-display {
            text-align: right;
        }

        .custo-label {
            color: rgba(245, 245, 220, 0.7);
            font-size: 0.9rem;
        }

        .custo-valor {
            font-weight: bold;
            color: var(--secondary-gold);
            font-size: 1.2rem;
            margin-left: 5px;
        }

        .status-item {
            background: rgba(44, 32, 8, 0.8);
            border: 2px solid var(--wood-light);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-header {
            margin-bottom: 20px;
        }

        .status-header h4 {
            color: var(--text-gold);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .status-header small {
            color: rgba(245, 245, 220, 0.7);
            font-size: 0.85rem;
        }

        .direcao-selecao {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--wood-light);
            border-radius: 50%;
            position: relative;
        }

        .radio-label input:checked + .radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--primary-gold);
            border-radius: 50%;
        }

        .radio-label input:checked + .radio-custom {
            border-color: var(--primary-gold);
        }

        .radio-text {
            color: var(--text-light);
        }

        .niveis-status {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 20px;
            align-items: start;
        }

        .nivel-contador {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .btn-nivel-status {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--wood-light);
            background: rgba(26, 18, 0, 0.8);
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-nivel-status:hover:not(:disabled) {
            border-color: var(--primary-gold);
            background: rgba(212, 175, 55, 0.2);
        }

        .btn-nivel-status:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nivel-info {
            text-align: center;
        }

        .nivel-valor {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-gold);
            display: block;
        }

        .nivel-descricao p {
            color: var(--text-light);
            line-height: 1.6;
            margin: 0;
        }

        .status-custo {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-custo span:first-child {
            color: rgba(245, 245, 220, 0.7);
        }

        .custo-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--secondary-gold);
        }

        .resumo-pontos {
            margin-top: 40px;
        }

        .resumo-card {
            background: linear-gradient(145deg, rgba(44, 32, 8, 0.9), rgba(26, 18, 0, 0.9));
            border: 2px solid var(--primary-gold);
            border-radius: 10px;
            padding: 20px;
        }

        .resumo-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-gold);
        }

        .resumo-header i {
            color: var(--primary-gold);
            font-size: 1.5rem;
        }

        .resumo-header h3 {
            color: var(--text-gold);
            font-family: 'Uncial Antiqua', cursive;
            font-size: 1.5rem;
        }

        .resumo-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .resumo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(26, 18, 0, 0.5);
            border-radius: 6px;
        }

        .resumo-item span:first-child {
            color: var(--text-light);
        }

        .resumo-item span:last-child {
            font-weight: bold;
            color: var(--text-gold);
        }

        .resumo-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
            margin-top: 10px;
            border: 2px solid var(--primary-gold);
        }

        .resumo-total span:first-child {
            color: var(--text-gold);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .resumo-total span:last-child {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .status-badge {
            background: var(--primary-gold);
            color: var(--primary-dark);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- HEADER PRINCIPAL -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-dragon" style="color: var(--primary-gold); font-size: 1.8rem;"></i>
            <h1>FORJAR PERSONAGEM</h1>
        </div>
        
        <div class="character-header">
            <input type="text" 
                   class="character-name-input" 
                   id="characterName" 
                   placeholder="Nome do Herói" 
                   maxlength="50"
                   autocomplete="off">
            
            <button class="btn-voltar" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
        </div>
    </header>

    <!-- MENU DE ABAS - TOPO -->
    <nav class="main-nav">
        <div class="nav-scroll-container">
            <div class="nav-menu">
                <button class="nav-btn" onclick="switchTab('dashboard')" id="tabDashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn active" onclick="switchTab('atributos')" id="tabAtributos">
                    <i class="fas fa-dumbbell"></i> Atributos
                </button>
                <button class="nav-btn" onclick="switchTab('caracteristicas')" id="tabCaracteristicas">
                    <i class="fas fa-user-tag"></i> Características
                </button>
                <button class="nav-btn" onclick="switchTab('vantagens')" id="tabVantagens">
                    <i class="fas fa-star"></i> Vant/Desv
                </button>
                <button class="nav-btn" onclick="switchTab('pericias')" id="tabPericias">
                    <i class="fas fa-book-open"></i> Perícias
                </button>
                <button class="nav-btn" onclick="switchTab('magia')" id="tabMagia">
                    <i class="fas fa-hat-wizard"></i> Magia
                </button>
                <button class="nav-btn" onclick="switchTab('combate')" id="tabCombate">
                    <i class="fas fa-fist-raised"></i> Combate
                </button>
                <button class="nav-btn" onclick="switchTab('equipamento')" id="tabEquipamento">
                    <i class="fas fa-shield-alt"></i> Equipamento
                </button>
                <button class="nav-btn" onclick="switchTab('resumo')" id="tabResumo">
                    <i class="fas fa-scroll"></i> Resumo
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content">
        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-tachometer-alt"></i>
                <h3>Dashboard do Personagem</h3>
                <p>Visão geral com todos os pontos gastos, atributos principais e status do personagem.</p>
                <p style="margin-top: 20px; color: rgba(212, 175, 55, 0.7);">
                    <i class="fas fa-hammer"></i> Será implementada por último
                </p>
            </div>
        </div>
                <!-- ATRIBUTOS -->
        <div id="atributos" class="tab-content active">
            <div class="atributos-container">
                <!-- HEADER SIMPLES -->
                <div class="atributos-header">
                    <h2><i class="fas fa-dumbbell"></i> Atributos do Personagem</h2>
                    <div class="card-pontos">
                        <div class="ponto-total">
                            <div class="ponto-label">Pontos Gastos em Atributos</div>
                            <div id="pontosGastos" class="ponto-valor">0</div>
                        </div>
                    </div>
                </div>

                <!-- 4 CARDS DE ATRIBUTOS LADO A LADO -->
                <div class="atributos-principais">
                    <!-- ST - FORÇA -->
                    <div class="atributo-card">
                        <div class="atributo-titulo">
                            <i class="fas fa-fist-raised"></i>
                            <div class="atributo-info">
                                <div class="atributo-sigla">ST</div>
                                <div class="atributo-nome">FORÇA</div>
                            </div>
                        </div>
                        
                        <div class="atributo-valor">
                            <button class="btn-atributo menos" onclick="alterarAtributo('ST', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="ST" class="input-atributo" value="10" min="1" max="40">
                            <button class="btn-atributo mais" onclick="alterarAtributo('ST', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="atributo-custo">
                            <span>Custo:</span>
                            <span id="custoST" class="custo-valor">0</span>
                        </div>
                    </div>

                    <!-- DX - DESTREZA -->
                    <div class="atributo-card">
                        <div class="atributo-titulo">
                            <i class="fas fa-running"></i>
                            <div class="atributo-info">
                                <div class="atributo-sigla">DX</div>
                                <div class="atributo-nome">DESTREZA</div>
                            </div>
                        </div>
                        
                        <div class="atributo-valor">
                            <button class="btn-atributo menos" onclick="alterarAtributo('DX', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="DX" class="input-atributo" value="10" min="1" max="40">
                            <button class="btn-atributo mais" onclick="alterarAtributo('DX', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="atributo-custo">
                            <span>Custo:</span>
                            <span id="custoDX" class="custo-valor">0</span>
                        </div>
                    </div>

                    <!-- IQ - INTELIGÊNCIA -->
                    <div class="atributo-card">
                        <div class="atributo-titulo">
                            <i class="fas fa-brain"></i>
                            <div class="atributo-info">
                                <div class="atributo-sigla">IQ</div>
                                <div class="atributo-nome">INTELIGÊNCIA</div>
                            </div>
                        </div>
                        
                        <div class="atributo-valor">
                            <button class="btn-atributo menos" onclick="alterarAtributo('IQ', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="IQ" class="input-atributo" value="10" min="1" max="40">
                            <button class="btn-atributo mais" onclick="alterarAtributo('IQ', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="atributo-custo">
                            <span>Custo:</span>
                            <span id="custoIQ" class="custo-valor">0</span>
                        </div>
                    </div>

                    <!-- HT - SAÚDE -->
                    <div class="atributo-card">
                        <div class="atributo-titulo">
                            <i class="fas fa-heart"></i>
                            <div class="atributo-info">
                                <div class="atributo-sigla">HT</div>
                                <div class="atributo-nome">SAÚDE</div>
                            </div>
                        </div>
                        
                        <div class="atributo-valor">
                            <button class="btn-atributo menos" onclick="alterarAtributo('HT', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="HT" class="input-atributo" value="10" min="1" max="40">
                            <button class="btn-atributo mais" onclick="alterarAtributo('HT', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="atributo-custo">
                            <span>Custo:</span>
                            <span id="custoHT" class="custo-valor">0</span>
                        </div>
                    </div>
                </div>

                <!-- ATRIBUTOS SECUNDÁRIOS -->
                <div class="secao-titulo">
                    <h3><i class="fas fa-calculator"></i> Atributos Secundários</h3>
                </div>
                
                <div class="atributos-secundarios">
                    <!-- PV - Pontos de Vida -->
                    <div class="secundario-card">
                        <div class="secundario-header">
                            <i class="fas fa-heartbeat"></i>
                            <div class="secundario-info">
                                <div class="secundario-sigla">PV</div>
                                <div class="secundario-nome">Pontos de Vida</div>
                            </div>
                        </div>
                        <div class="secundario-base">Base: <span id="PVBase">10</span></div>
                        
                        <!-- BOTÕES +/- PARA PV -->
                        <div class="secundario-ajuste">
                            <button class="btn-secundario menos" onclick="ajustarSecundario('PV', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="bonusPV" class="secundario-bonus" value="0" placeholder="Bônus">
                            <button class="btn-secundario mais" onclick="ajustarSecundario('PV', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="secundario-total">Total: <span id="PVTotal">10</span></div>
                    </div>

                    <!-- PF - Pontos de Fadiga -->
                    <div class="secundario-card">
                        <div class="secundario-header">
                            <i class="fas fa-wind"></i>
                            <div class="secundario-info">
                                <div class="secundario-sigla">PF</div>
                                <div class="secundario-nome">Pontos de Fadiga</div>
                            </div>
                        </div>
                        <div class="secundario-base">Base: <span id="PFBase">10</span></div>
                        
                        <!-- BOTÕES +/- PARA PF -->
                        <div class="secundario-ajuste">
                            <button class="btn-secundario menos" onclick="ajustarSecundario('PF', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="bonusPF" class="secundario-bonus" value="0" placeholder="Bônus">
                            <button class="btn-secundario mais" onclick="ajustarSecundario('PF', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="secundario-total">Total: <span id="PFTotal">10</span></div>
                    </div>

                    <!-- VONTADE -->
                    <div class="secundario-card">
                        <div class="secundario-header">
                            <i class="fas fa-cross"></i>
                            <div class="secundario-info">
                                <div class="secundario-sigla">VON</div>
                                <div class="secundario-nome">Vontade</div>
                            </div>
                        </div>
                        <div class="secundario-base">Base: <span id="VontadeBase">11</span></div>
                        
                        <!-- BOTÕES +/- PARA VONTADE -->
                        <div class="secundario-ajuste">
                            <button class="btn-secundario menos" onclick="ajustarSecundario('Vontade', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="bonusVontade" class="secundario-bonus" value="0" placeholder="Bônus">
                            <button class="btn-secundario mais" onclick="ajustarSecundario('Vontade', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="secundario-total">Total: <span id="VontadeTotal">11</span></div>
                    </div>

                    <!-- PERCEPÇÃO -->
                    <div class="secundario-card">
                        <div class="secundario-header">
                            <i class="fas fa-eye"></i>
                            <div class="secundario-info">
                                <div class="secundario-sigla">PER</div>
                                <div class="secundario-nome">Percepção</div>
                            </div>
                        </div>
                        <div class="secundario-base">Base: <span id="PercepcaoBase">11</span></div>
                        
                        <!-- BOTÕES +/- PARA PERCEPÇÃO -->
                        <div class="secundario-ajuste">
                            <button class="btn-secundario menos" onclick="ajustarSecundario('Percepcao', -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="bonusPercepcao" class="secundario-bonus" value="0" placeholder="Bônus">
                            <button class="btn-secundario mais" onclick="ajustarSecundario('Percepcao', 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="secundario-total">Total: <span id="PercepcaoTotal">11</span></div>
                    </div>

                    <!-- DESLOCAMENTO -->
                    <div class="secundario-card">
                        <div class="secundario-header">
                            <i class="fas fa-shoe-prints"></i>
                            <div class="secundario-info">
                                <div class="secundario-sigla">DES</div>
                                <div class="secundario-nome">Deslocamento</div>
                            </div>
                        </div>
                        <div class="secundario-base">Base: <span id="DeslocamentoBase">5.00</span></div>
                        
                        <!-- BOTÕES +/- PARA DESLOCAMENTO -->
                        <div class="secundario-ajuste">
                            <button class="btn-secundario menos" onclick="ajustarSecundario('Deslocamento', -0.25)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="bonusDeslocamento" class="secundario-bonus" value="0" step="0.25" placeholder="Bônus">
                            <button class="btn-secundario mais" onclick="ajustarSecundario('Deslocamento', 0.25)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="secundario-total">Total: <span id="DeslocamentoTotal">5.00</span></div>
                    </div>
                </div>

                <!-- TÁBUAS DE REFERÊNCIA -->
                <div class="secao-titulo">
                    <h3><i class="fas fa-table"></i> Tabelas de Referência</h3>
                </div>
                
                <div class="tabelas-container">
                    <div class="tabela-card">
                        <div class="tabela-titulo">
                            <i class="fas fa-sword"></i>
                            <span>Dano Base (ST: <span id="currentST">10</span>)</span>
                        </div>
                        <div class="tabela-conteudo">
                            <div class="tabela-item">
                                <span class="tabela-label">Golpe Desarmado (GDP):</span>
                                <span id="danoGDP" class="tabela-valor">1d-2</span>
                            </div>
                            <div class="tabela-item">
                                <span class="tabela-label">Golpe com Arma (GEB):</span>
                                <span id="danoGEB" class="tabela-valor">1d</span>
                            </div>
                        </div>
                    </div>

                    <div class="tabela-card">
                        <div class="tabela-titulo">
                            <i class="fas fa-weight-hanging"></i>
                            <span>Capacidade de Carga (ST: <span id="currentST2">10</span>)</span>
                        </div>
                        <div class="tabela-conteudo">
                            <div class="tabela-item">
                                <span class="tabela-label">Nenhuma:</span>
                                <span id="cargaNenhuma" class="tabela-valor">10.0</span>
                            </div>
                            <div class="tabela-item">
                                <span class="tabela-label">Leve:</span>
                                <span id="cargaLeve" class="tabela-valor">20.0</span>
                            </div>
                            <div class="tabela-item">
                                <span class="tabela-label">Média:</span>
                                <span id="cargaMedia" class="tabela-valor">30.0</span>
                            </div>
                            <div class="tabela-item">
                                <span class="tabela-label">Pesada:</span>
                                <span id="cargaPesada" class="tabela-valor">60.0</span>
                            </div>
                            <div class="tabela-item">
                                <span class="tabela-label">Muito Pesada:</span>
                                <span id="cargaMuitoPesada" class="tabela-valor">100.0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MENSAGEM DE STATUS -->
                <div id="statusAtributos" class="status-mensagem">
                    <i class="fas fa-info-circle"></i>
                    <span>Sistema de atributos inicializado. Ajuste os valores conforme necessário.</span>
                </div>
            </div>
        </div>
                <!-- ABA CARACTERÍSTICAS -->
        <div id="caracteristicas" class="tab-content">
            <div class="caracteristicas-container">
                <!-- TABS DE NAVEGAÇÃO -->
                <div class="subtabs-navigation">
                    <button class="subtab-btn active" data-subtab="social-aparencia">
                        <i class="fas fa-user-tie"></i> Status Social & Aparência
                    </button>
                    <button class="subtab-btn" data-subtab="caracteristicas-fisicas">
                        <i class="fas fa-ruler-combined"></i> Características Físicas
                    </button>
                </div>

                <!-- CONTEÚDO DAS SUB-ABAS -->
                <div class="subtabs-content">
                    <!-- SUB-ABA 1: STATUS SOCIAL & APARÊNCIA -->
                    <div id="subtab-social-aparencia" class="subtab-pane active">
                        <!-- CARD APARÊNCIA FÍSICA -->
                        <div class="caracteristica-card">
                            <div class="card-header">
                                <i class="fas fa-user"></i>
                                <h3>Aparência Física</h3>
                                <span class="pontos-badge" id="pontosAparencia">0 pts</span>
                            </div>
                            <div class="card-content">
                                <div class="select-group">
                                    <label>Nível de Aparência:</label>
                                    <select id="nivelAparencia" class="form-select">
                                        <option value="-24">Horrendo [-24 pts]</option>
                                        <option value="-20">Monstruoso [-20 pts]</option>
                                        <option value="-16">Hediondo [-16 pts]</option>
                                        <option value="-8">Feio [-8 pts]</option>
                                        <option value="-4">Sem Atrativos [-4 pts]</option>
                                        <option value="0" selected>Comum [0 pts]</option>
                                        <option value="4">Atraente [+4 pts]</option>
                                        <option value="12">Elegante [+12 pts]</option>
                                        <option value="16">Muito Elegante [+16 pts]</option>
                                        <option value="20">Lindo [+20 pts]</option>
                                    </select>
                                </div>
                                <div class="info-display" id="displayAparencia">
                                    <strong>Comum</strong>
                                    <br><small>Reação: +0</small>
                                    <br><small>Aparência padrão, sem modificadores</small>
                                </div>
                            </div>
                        </div>

                        <!-- CARD NÍVEL DE RIQUEZA -->
                        <div class="caracteristica-card">
                            <div class="card-header">
                                <i class="fas fa-coins"></i>
                                <h3>Nível de Riqueza</h3>
                                <span class="pontos-badge" id="pontosRiqueza">0 pts</span>
                            </div>
                            <div class="card-content">
                                <div class="select-group">
                                    <label>Nível de Riqueza:</label>
                                    <select id="nivelRiqueza" class="form-select">
                                        <option value="-25">Falido [-25 pts]</option>
                                        <option value="-15">Pobre [-15 pts]</option>
                                        <option value="-10">Batalhador [-10 pts]</option>
                                        <option value="0" selected>Médio [0 pts]</option>
                                        <option value="10">Confortável [+10 pts]</option>
                                        <option value="20">Rico [+20 pts]</option>
                                        <option value="30">Muito Rico [+30 pts]</option>
                                        <option value="50">Podre de Rico [+50 pts]</option>
                                    </select>
                                </div>
                                <div class="info-display" id="displayRiqueza">
                                    <strong>Médio</strong>
                                    <br><small>Multiplicador: 1x</small>
                                    <br><small>Nível de recursos pré-definido padrão</small>
                                </div>
                                <div class="renda-info">
                                    <small>Renda Mensal Estimada: <span id="rendaMensal">$1.000</span></small>
                                </div>
                            </div>
                        </div>

                        <!-- CARD IDIOMAS -->
                        <div class="caracteristica-card full-width">
                            <div class="card-header">
                                <i class="fas fa-globe"></i>
                                <h3>Idiomas</h3>
                                <span class="pontos-badge" id="pontosIdiomas">0 pts</span>
                            </div>
                            <div class="card-content">
                                <!-- IDIOMA MATERNO -->
                                <div class="idioma-section">
                                    <h4>Idioma Materno</h4>
                                    <div class="idioma-materno">
                                        <input type="text" id="idiomaMaternoNome" value="Comum" placeholder="Nome do idioma materno" class="form-input">
                                        <span class="nivel-info">Nativo (0 pts)</span>
                                    </div>
                                </div>

                                <!-- DESVANTAGENS DE ALFABETIZAÇÃO -->
                                <div class="idioma-section">
                                    <h4>Alfabetização</h4>
                                    <div class="alfabetizacao-options">
                                        <div class="option-group">
                                            <label class="option-label">
                                                <input type="radio" name="alfabetizacao" value="0" checked>
                                                <span class="option-text">Alfabetizado (0 pts)</span>
                                            </label>
                                            <label class="option-label">
                                                <input type="radio" name="alfabetizacao" value="-2">
                                                <span class="option-text">Semianalfabeto [-2 pts]</span>
                                            </label>
                                            <label class="option-label">
                                                <input type="radio" name="alfabetizacao" value="-3">
                                                <span class="option-text">Analfabeto [-3 pts]</span>
                                            </label>
                                        </div>
                                        <div class="option-description">
                                            <small id="descAlfabetizacao">Consegue ler e escrever normalmente.</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- ADICIONAR NOVO IDIOMA -->
                                <div class="idioma-section">
                                    <h4>Adicionar Idioma</h4>
                                    <div class="add-idioma-form">
                                        <input type="text" id="novoIdiomaNome" placeholder="Digite o nome do idioma" class="form-input">
                                        
                                        <div class="niveis-container">
                                            <div class="nivel-group">
                                                <label><i class="fas fa-comment"></i> Nível de Fala:</label>
                                                <select id="novoIdiomaFala" class="form-select">
                                                    <option value="0">Nenhum (0 pts)</option>
                                                    <option value="2" selected>Rudimentar (2 pts)</option>
                                                    <option value="4">Sotaque (4 pts)</option>
                                                    <option value="6">Nativo (6 pts)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="nivel-group">
                                                <label><i class="fas fa-pen"></i> Nível de Escrita:</label>
                                                <select id="novoIdiomaEscrita" class="form-select">
                                                    <option value="0" selected>Nenhum (0 pts)</option>
                                                    <option value="2">Rudimentar (1 pt)</option>
                                                    <option value="4">Sotaque (2 pts)</option>
                                                    <option value="6">Nativo (3 pts)</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="add-idioma-actions">
                                            <span class="custo-preview">Custo: <span id="custoIdiomaPreview">+2 pts</span></span>
                                            <button id="btnAdicionarIdioma" class="btn-primary">
                                                <i class="fas fa-plus"></i> Adicionar Idioma
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- LISTA DE IDIOMAS ADICIONAIS -->
                                <div class="idioma-section">
                                    <h4>Idiomas Adicionais <small>(<span id="totalIdiomas">0</span> idiomas)</small></h4>
                                    <div id="listaIdiomasAdicionais" class="idiomas-lista">
                                        <div class="empty-state">
                                            Nenhum idioma adicional adicionado
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SUB-ABA 2: CARACTERÍSTICAS FÍSICAS -->
                    <div id="subtab-caracteristicas-fisicas" class="subtab-pane">
                        <!-- CARDS SUPERIORES -->
                        <div class="caracteristicas-grid">
                            <!-- CARD ESQUERDO: CARACTERÍSTICAS FÍSICAS -->
                            <div class="caracteristica-card">
                                <div class="card-header">
                                    <i class="fas fa-weight"></i>
                                    <h3>Características Físicas</h3>
                                    <span class="pontos-badge" id="pontosCaracteristicas">0 pts</span>
                                </div>
                                <div class="card-content">
                                    <!-- LISTA DE CARACTERÍSTICAS FÍSICAS (os 6 itens FIXOS) -->
                                    <div class="caracteristicas-lista">
                                        <!-- ITEM 1: MAGRO -->
                                        <div class="caracteristica-item" data-tipo="magro">
                                            <div class="caracteristica-info">
                                                <strong>Magro</strong>
                                                <small>-5 pts | Peso: 67% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="magro">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 2: ACIMA DO PESO -->
                                        <div class="caracteristica-item" data-tipo="acima-peso">
                                            <div class="caracteristica-info">
                                                <strong>Acima do Peso</strong>
                                                <small>-1 pt | Peso: 130% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="acima-peso">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 3: GORDO -->
                                        <div class="caracteristica-item" data-tipo="gordo">
                                            <div class="caracteristica-info">
                                                <strong>Gordo</strong>
                                                <small>-3 pts | Peso: 150% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="gordo">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 4: MUITO GORDO -->
                                        <div class="caracteristica-item" data-tipo="muito-gordo">
                                            <div class="caracteristica-info">
                                                <strong>Muito Gordo</strong>
                                                <small>-5 pts | Peso: 200% do normal</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="muito-gordo">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 5: NANISMO -->
                                        <div class="caracteristica-item" data-tipo="nanismo">
                                            <div class="caracteristica-info">
                                                <strong>Nanismo</strong>
                                                <small>-15 pts | Altura máxima: 1.32m</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="nanismo">
                                                Adicionar
                                            </button>
                                        </div>
                                        
                                        <!-- ITEM 6: GIGANTISMO -->
                                        <div class="caracteristica-item" data-tipo="gigantismo">
                                            <div class="caracteristica-info">
                                                <strong>Gigantismo</strong>
                                                <small>0 pts | MT +1, +1 Deslocamento</small>
                                            </div>
                                            <button class="btn-add-caracteristica" data-tipo="gigantismo">
                                                Adicionar
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- CARACTERÍSTICAS SELECIONADAS -->
                                    <div id="caracteristicasSelecionadas" class="caracteristicas-selecionadas">
                                        <!-- Dinâmico - características adicionadas aparecem aqui -->
                                    </div>
                                </div>
                            </div>

                            <!-- CARD DIREITO: ALTURA E PESO -->
                            <div class="caracteristica-card">
                                <div class="card-header">
                                    <i class="fas fa-ruler-combined"></i>
                                    <h3>Altura e Peso</h3>
                                    <span class="status-badge" id="statusFisico">Normal</span>
                                </div>
                                <div class="card-content">
                                    <!-- CONTROLES ALTURA -->
                                    <div class="fisica-control">
                                        <label><i class="fas fa-ruler-vertical"></i> Altura (metros):</label>
                                        <div class="controle-numerico">
                                            <button class="btn-controle" onclick="ajustarAltura(-0.01)">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" id="altura" value="1.70" step="0.01" min="1.20" max="2.50" class="fisica-input">
                                            <button class="btn-controle" onclick="ajustarAltura(0.01)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <div id="statusAltura" class="status-info"></div>
                                    </div>

                                    <!-- CONTROLES PESO -->
                                    <div class="fisica-control">
                                        <label><i class="fas fa-weight-scale"></i> Peso (kg):</label>
                                        <div class="controle-numerico">
                                            <button class="btn-controle" onclick="ajustarPeso(-1)">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" id="peso" value="70" step="1" min="20" max="200" class="fisica-input">
                                            <button class="btn-controle" onclick="ajustarPeso(1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <div id="statusPeso" class="status-info"></div>
                                    </div>

                                    <!-- DESVANTAGENS ATIVAS -->
                                    <div class="desvantagens-ativas" id="desvantagensAtivas" style="display: none;">
                                        <div class="desvantagens-header">
                                            <i class="fas fa-list-check"></i>
                                            <h4>Características Físicas Ativas</h4>
                                        </div>
                                        <div class="desvantagens-lista" id="listaDesvantagens">
                                            <!-- Dinâmico -->
                                        </div>
                                    </div>

                                    <!-- INFO BASE ST -->
                                    <div class="fisica-info">
                                        <div class="info-row">
                                            <span>ST Base:</span>
                                            <strong id="stBase">10</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Faixa de Altura (ST):</span>
                                            <span id="alturaFaixa">1.58m - 1.83m</span>
                                        </div>
                                        <div class="info-row">
                                            <span>Faixa de Peso (ST):</span>
                                            <span id="pesoFaixa">57.5kg - 87.5kg</span>
                                        </div>
                                        <div class="info-row">
                                            <span>Status:</span>
                                            <span id="modificadorPeso">Dentro da faixa</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CARD INFERIOR: CARACTERÍSTICAS VISUAIS (SIMPLIFICADO) -->
                        <div class="caracteristica-card full-width">
                            <div class="card-header">
                                <i class="fas fa-eye"></i>
                                <h3>Aparência Visual</h3>
                            </div>
                            <div class="card-content">
                                <div class="visual-grid">
                                    <!-- COR DA PELE -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-palette"></i> Cor da Pele:</label>
                                        <select class="form-select select-visual" data-tipo="cor-pele">
                                            <option value="Muito clara">Muito clara</option>
                                            <option value="Clara">Clara</option>
                                            <option value="Morena clara">Morena clara</option>
                                            <option value="Morena" selected>Morena</option>
                                            <option value="Morena escura">Morena escura</option>
                                            <option value="Escura">Escura</option>
                                            <option value="Muito escura">Muito escura</option>
                                        </select>
                                    </div>

                                    <!-- COR DOS OLHOS -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-eye"></i> Cor dos Olhos:</label>
                                        <select class="form-select select-visual" data-tipo="cor-olhos">
                                            <option value="Azuis">Azuis</option>
                                            <option value="Verdes">Verdes</option>
                                            <option value="Castanhos claros">Castanhos claros</option>
                                            <option value="Castanhos" selected>Castanhos</option>
                                            <option value="Castanhos escuros">Castanhos escuros</option>
                                            <option value="Pretos">Pretos</option>
                                            <option value="Vermelhos">Vermelhos</option>
                                            <option value="Âmbar">Âmbar</option>
                                        </select>
                                    </div>

                                    <!-- COR DO CABELO -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-user-hair"></i> Cor do Cabelo:</label>
                                        <select class="form-select select-visual" data-tipo="cor-cabelo">
                                            <option value="Loiro">Loiro</option>
                                            <option value="Ruivo">Ruivo</option>
                                            <option value="Castanho claro">Castanho claro</option>
                                            <option value="Castanho" selected>Castanho</option>
                                            <option value="Castanho escuro">Castanho escuro</option>
                                            <option value="Preto">Preto</option>
                                            <option value="Grisalho">Grisalho</option>
                                            <option value="Branco">Branco</option>
                                        </select>
                                    </div>

                                    <!-- TIPO DE CABELO -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-user-hair-long"></i> Tipo de Cabelo:</label>
                                        <select class="form-select select-visual" data-tipo="tipo-cabelo">
                                            <option value="Liso">Liso</option>
                                            <option value="Ondulado">Ondulado</option>
                                            <option value="Cacheado">Cacheado</option>
                                            <option value="Crespo">Crespo</option>
                                            <option value="Careca">Careca</option>
                                            <option value="Calvo">Calvo</option>
                                            <option value="Longo">Longo</option>
                                            <option value="Curto" selected>Curto</option>
                                            <option value="Médio">Médio</option>
                                        </select>
                                    </div>

                                    <!-- IDADE (campo numérico) -->
                                    <div class="visual-group">
                                        <label><i class="fas fa-birthday-cake"></i> Idade:</label>
                                        <div class="controle-numerico">
                                            <button class="btn-controle" onclick="ajustarIdade(-1)">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" id="idade-personagem" value="25" min="12" max="100" class="fisica-input">
                                            <button class="btn-controle" onclick="ajustarIdade(1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- DESCRIÇÃO DA APARÊNCIA (automaticamente gerada) -->
                                <div class="descricao-visual">
                                    <h4><i class="fas fa-file-alt"></i> Descrição da Aparência:</h4>
                                    <div id="descricaoVisual" class="texto-descricao">
                                        25 anos, pele morena, olhos castanhos, cabelo castanho curto
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <!-- ABA VANTAGENS -->
        <div id="vantagens" class="tab-content">
            <div class="caracteristicas-container">
                <!-- SUB-ABAS INTERNAS -->
                <div class="subtabs-navigation">
                    <button class="subtab-btn active" data-subtab="atributos-relacoes">
                        <i class="fas fa-user-cog"></i> Atributos & Relações
                    </button>
                    <button class="subtab-btn" data-subtab="catalogo-geral">
                        <i class="fas fa-book"></i> Catálogo Geral
                    </button>
                </div>

                <!-- CONTEÚDO DAS SUB-ABAS -->
                <div class="subtabs-content">
                    <!-- SUB-ABA 1: ATRIBUTOS & RELAÇÕES -->
                    <div id="subtab-atributos-relacoes" class="subtab-pane active">
                        <!-- GRID COM 2 CARDS -->
                        <div class="caracteristicas-grid">
                            <!-- CARD 1: ATRIBUTOS COMPLEMENTARES -->
                            <div class="caracteristica-card">
                                <div class="card-header">
                                    <i class="fas fa-heart-plus"></i>
                                    <h3>Atributos Complementares</h3>
                                    <span class="pontos-badge" id="pontosAtributos">0 pts</span>
                                </div>
                                
                                <div class="card-content">
                                    <!-- FORÇA DE VONTADE -->
                                    <div class="atributo-item" data-tipo="forca-vontade" data-custo="5">
                                        <div class="atributo-info">
                                            <div class="atributo-header">
                                                <i class="fas fa-brain"></i>
                                                <div class="atributo-detalhes">
                                                    <strong>Força de Vontade</strong>
                                                    <small>Custo: ±5 pts por nível</small>
                                                </div>
                                            </div>
                                            <div class="atributo-controles">
                                                <div class="botoes-direcao">
                                                    <button class="btn-vantagem" data-direcao="positivo">
                                                        <i class="fas fa-plus"></i> Vantagem
                                                    </button>
                                                    <button class="btn-desvantagem" data-direcao="negativo">
                                                        <i class="fas fa-minus"></i> Desvantagem
                                                    </button>
                                                </div>
                                                <div class="contador-nivel">
                                                    <button class="btn-nivel menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <span class="nivel-display">0</span>
                                                    <button class="btn-nivel mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <span class="status-direcao neutro">Neutro</span>
                                                </div>
                                                <div class="custo-display">
                                                    <span class="custo-label">Custo:</span>
                                                    <span class="custo-valor">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- PERCEPÇÃO -->
                                    <div class="atributo-item" data-tipo="percepcao" data-custo="5">
                                        <div class="atributo-info">
                                            <div class="atributo-header">
                                                <i class="fas fa-eye"></i>
                                                <div class="atributo-detalhes">
                                                    <strong>Percepção</strong>
                                                    <small>Custo: ±5 pts por nível</small>
                                                </div>
                                            </div>
                                            <div class="atributo-controles">
                                                <div class="botoes-direcao">
                                                    <button class="btn-vantagem" data-direcao="positivo">
                                                        <i class="fas fa-plus"></i> Vantagem
                                                    </button>
                                                    <button class="btn-desvantagem" data-direcao="negativo">
                                                        <i class="fas fa-minus"></i> Desvantagem
                                                    </button>
                                                </div>
                                                <div class="contador-nivel">
                                                    <button class="btn-nivel menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <span class="nivel-display">0</span>
                                                    <button class="btn-nivel mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <span class="status-direcao neutro">Neutro</span>
                                                </div>
                                                <div class="custo-display">
                                                    <span class="custo-label">Custo:</span>
                                                    <span class="custo-valor">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- PONTOS DE VIDA -->
                                    <div class="atributo-item" data-tipo="pv" data-custo="2">
                                        <div class="atributo-info">
                                            <div class="atributo-header">
                                                <i class="fas fa-heartbeat"></i>
                                                <div class="atributo-detalhes">
                                                    <strong>Pontos de Vida</strong>
                                                    <small>Custo: ±2 pts por nível</small>
                                                </div>
                                            </div>
                                            <div class="atributo-controles">
                                                <div class="botoes-direcao">
                                                    <button class="btn-vantagem" data-direcao="positivo">
                                                        <i class="fas fa-plus"></i> Vantagem
                                                    </button>
                                                    <button class="btn-desvantagem" data-direcao="negativo">
                                                        <i class="fas fa-minus"></i> Desvantagem
                                                    </button>
                                                </div>
                                                <div class="contador-nivel">
                                                    <button class="btn-nivel menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <span class="nivel-display">0</span>
                                                    <button class="btn-nivel mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <span class="status-direcao neutro">Neutro</span>
                                                </div>
                                                <div class="custo-display">
                                                    <span class="custo-label">Custo:</span>
                                                    <span class="custo-valor">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- PONTOS DE FADIGA -->
                                    <div class="atributo-item" data-tipo="pf" data-custo="3">
                                        <div class="atributo-info">
                                            <div class="atributo-header">
                                                <i class="fas fa-wind"></i>
                                                <div class="atributo-detalhes">
                                                    <strong>Pontos de Fadiga</strong>
                                                    <small>Custo: ±3 pts por nível</small>
                                                </div>
                                            </div>
                                            <div class="atributo-controles">
                                                <div class="botoes-direcao">
                                                    <button class="btn-vantagem" data-direcao="positivo">
                                                        <i class="fas fa-plus"></i> Vantagem
                                                    </button>
                                                    <button class="btn-desvantagem" data-direcao="negativo">
                                                        <i class="fas fa-minus"></i> Desvantagem
                                                    </button>
                                                </div>
                                                <div class="contador-nivel">
                                                    <button class="btn-nivel menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <span class="nivel-display">0</span>
                                                    <button class="btn-nivel mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <span class="status-direcao neutro">Neutro</span>
                                                </div>
                                                <div class="custo-display">
                                                    <span class="custo-label">Custo:</span>
                                                    <span class="custo-valor">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- VELOCIDADE BÁSICA -->
                                    <div class="atributo-item" data-tipo="velocidade" data-custo="5" data-fator="0.25">
                                        <div class="atributo-info">
                                            <div class="atributo-header">
                                                <i class="fas fa-tachometer-alt"></i>
                                                <div class="atributo-detalhes">
                                                    <strong>Velocidade Básica</strong>
                                                    <small>Custo: ±5 pts por 0.25</small>
                                                </div>
                                            </div>
                                            <div class="atributo-controles">
                                                <div class="botoes-direcao">
                                                    <button class="btn-vantagem" data-direcao="positivo">
                                                        <i class="fas fa-plus"></i> Vantagem
                                                    </button>
                                                    <button class="btn-desvantagem" data-direcao="negativo">
                                                        <i class="fas fa-minus"></i> Desvantagem
                                                    </button>
                                                </div>
                                                <div class="contador-nivel">
                                                    <button class="btn-nivel menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <span class="nivel-display">0.00</span>
                                                    <button class="btn-nivel mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <span class="status-direcao neutro">Neutro</span>
                                                </div>
                                                <div class="custo-display">
                                                    <span class="custo-label">Custo:</span>
                                                    <span class="custo-valor">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- DESLOCAMENTO BÁSICO -->
                                    <div class="atributo-item" data-tipo="deslocamento" data-custo="5" data-fator="1">
                                        <div class="atributo-info">
                                            <div class="atributo-header">
                                                <i class="fas fa-running"></i>
                                                <div class="atributo-detalhes">
                                                    <strong>Deslocamento Básico</strong>
                                                    <small>Custo: ±5 pts por 1m</small>
                                                </div>
                                            </div>
                                            <div class="atributo-controles">
                                                <div class="botoes-direcao">
                                                    <button class="btn-vantagem" data-direcao="positivo">
                                                        <i class="fas fa-plus"></i> Vantagem
                                                    </button>
                                                    <button class="btn-desvantagem" data-direcao="negativo">
                                                        <i class="fas fa-minus"></i> Desvantagem
                                                    </button>
                                                </div>
                                                <div class="contador-nivel">
                                                    <button class="btn-nivel menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <span class="nivel-display">0</span>
                                                    <button class="btn-nivel mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <span class="status-direcao neutro">Neutro</span>
                                                </div>
                                                <div class="custo-display">
                                                    <span class="custo-label">Custo:</span>
                                                    <span class="custo-valor">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- CARD 2: STATUS & REPUTAÇÃO -->
                            <div class="caracteristica-card">
                                <div class="card-header">
                                    <i class="fas fa-crown"></i>
                                    <h3>Status & Reputação</h3>
                                    <span class="pontos-badge" id="pontosStatus">0 pts</span>
                                </div>
                                
                                <div class="card-content">
                                    <!-- STATUS -->
                                    <div class="status-item" data-tipo="status" data-custo="5">
                                        <div class="status-header">
                                            <h4><i class="fas fa-user-tie"></i> Status</h4>
                                            <small>±5 pts por nível (máx. 4 níveis)</small>
                                        </div>
                                        
                                        <div class="status-controles">
                                            <div class="direcao-selecao">
                                                <label class="radio-label">
                                                    <input type="radio" name="status-direcao" value="positivo">
                                                    <span class="radio-custom"></span>
                                                    <span class="radio-text">Positivo (Vantagem)</span>
                                                </label>
                                                <label class="radio-label">
                                                    <input type="radio" name="status-direcao" value="negativo">
                                                    <span class="radio-custom"></span>
                                                    <span class="radio-text">Negativo (Desvantagem)</span>
                                                </label>
                                                <label class="radio-label">
                                                    <input type="radio" name="status-direcao" value="neutro" checked>
                                                    <span class="radio-custom"></span>
                                                    <span class="radio-text">Neutro</span>
                                                </label>
                                            </div>
                                            
                                            <div class="niveis-status">
                                                <div class="nivel-contador">
                                                    <button class="btn-nivel-status menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <div class="nivel-info">
                                                        <span class="nivel-valor">0</span>
                                                        <small>Níveis</small>
                                                    </div>
                                                    <button class="btn-nivel-status mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                </div>
                                                
                                                <div class="nivel-descricao">
                                                    <p id="descStatus">Status padrão, sem modificadores</p>
                                                </div>
                                            </div>
                                            
                                            <div class="status-custo">
                                                <span>Custo Total:</span>
                                                <span id="custoStatus" class="custo-total">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- REPUTAÇÃO -->
                                    <div class="status-item" data-tipo="reputacao" data-custo="5">
                                        <div class="status-header">
                                            <h4><i class="fas fa-star"></i> Reputação</h4>
                                            <small>±5 pts por nível (máx. 4 níveis)</small>
                                        </div>
                                        
                                        <div class="status-controles">
                                            <div class="direcao-selecao">
                                                <label class="radio-label">
                                                    <input type="radio" name="reputacao-direcao" value="positivo">
                                                    <span class="radio-custom"></span>
                                                    <span class="radio-text">Positiva (Vantagem)</span>
                                                </label>
                                                <label class="radio-label">
                                                    <input type="radio" name="reputacao-direcao" value="negativo">
                                                    <span class="radio-custom"></span>
                                                    <span class="radio-text">Negativa (Desvantagem)</span>
                                                </label>
                                                <label class="radio-label">
                                                    <input type="radio" name="reputacao-direcao" value="neutro" checked>
                                                    <span class="radio-custom"></span>
                                                    <span class="radio-text">Neutra</span>
                                                </label>
                                            </div>
                                            
                                            <div class="niveis-status">
                                                <div class="nivel-contador">
                                                    <button class="btn-nivel-status menos" disabled>
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <div class="nivel-info">
                                                        <span class="nivel-valor">0</span>
                                                        <small>Níveis</small>
                                                    </div>
                                                    <button class="btn-nivel-status mais" disabled>
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                </div>
                                                
                                                <div class="nivel-descricao">
                                                    <p id="descReputacao">Reputação padrão, sem modificadores</p>
                                                </div>
                                            </div>
                                            
                                            <div class="status-custo">
                                                <span>Custo Total:</span>
                                                <span id="custoReputacao" class="custo-total">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- RESUMO DOS PONTOS -->
                        <div class="resumo-pontos">
                            <div class="resumo-card">
                                <div class="resumo-header">
                                    <i class="fas fa-calculator"></i>
                                    <h3>Resumo de Pontos</h3>
                                </div>
                                <div class="resumo-content">
                                    <div class="resumo-item">
                                        <span>Atributos Complementares:</span>
                                        <span id="totalAtributos">0</span>
                                    </div>
                                    <div class="resumo-item">
                                        <span>Status & Reputação:</span>
                                        <span id="totalStatusRep">0</span>
                                    </div>
                                    <div class="resumo-total">
                                        <span>TOTAL GASTO:</span>
                                        <span id="totalGeral">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SUB-ABA 2: CATÁLOGO GERAL -->
                    <div id="subtab-catalogo-geral" class="subtab-pane">
                        <div class="content-placeholder">
                            <i class="fas fa-book"></i>
                            <h3>Catálogo Geral</h3>
                            <p>Sistema completo de Vantagens e Desvantagens (Físicas, Mental/Sobrenatural, Social, Supers)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <!-- PERÍCIAS -->
        <div id="pericias" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-book-open"></i>
                <h3>Perícias e Técnicas</h3>
                <p>Adicione e gerencie todas as perícias, habilidades e técnicas.</p>
            </div>
        </div>

        <!-- MAGIA -->
        <div id="magia" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-hat-wizard"></i>
                <h3>Sistema Mágico</h3>
                <p>Configure magias, poderes, mana e habilidades sobrenaturais.</p>
            </div>
        </div>

        <!-- COMBATE -->
        <div id="combate" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-fist-raised"></i>
                <h3>Proezas de Combate</h3>
                <p>Defina armas, defesas, manobras e táticas de combate.</p>
            </div>
        </div>

        <!-- EQUIPAMENTO -->
        <div id="equipamento" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-shield-alt"></i>
                <h3>Inventário</h3>
                <p>Gerencie equipamentos, itens, riqueza e carga do personagem.</p>
            </div>
        </div>

        <!-- RESUMO -->
        <div id="resumo" class="tab-content">
            <div class="content-placeholder">
                <i class="fas fa-scroll"></i>
                <h3>Ficha Completa</h3>
                <p>Visualização final e exportação da ficha do personagem.</p>
            </div>
        </div>
    </main>

    <!-- BARRA DE AÇÕES -->
    <div class="action-bar">
        <div class="action-group">
            <button class="action-btn btn-cancelar" onclick="cancelCreation()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="action-btn btn-cancelar" onclick="resetCharacter()">
                <i class="fas fa-redo"></i> Limpar Tudo
            </button>
        </div>
        
        <div class="action-group">
            <button class="action-btn btn-salvar" onclick="saveDraft()">
                <i class="fas fa-save"></i> Salvar Rascunho
            </button>
            <button class="action-btn btn-finalizar" onclick="finalizeCharacter()">
                <i class="fas fa-check-double"></i> Finalizar Personagem
            </button>
        </div>
    </div>

    <!-- NOTIFICAÇÃO -->
    <div id="custom-toast"></div>

    <script>
        // ===========================================
        // INICIALIZAÇÃO FIREBASE
        // ===========================================
        let app, auth, db;
        let currentCharacterId = null;
        let currentUser = null;
        let isInitialized = false;

        if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
            app = firebase.app();
            auth = firebase.auth();
            db = firebase.firestore();
        } else {
            const firebaseConfig = {
                apiKey: "AIzaSyBoTP0oJH4q3yrc0N8sCv9ynKN53dN-UbU",
                authDomain: "gurpsroll.firebaseapp.com",
                projectId: "gurpsroll"
            };
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        }

        // ===========================================
        // VERIFICAÇÃO DE AUTENTICAÇÃO
        // ===========================================
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                console.log('✅ Usuário autenticado:', user.uid);
                loadCharacterData();
                isInitialized = true;
            } else {
                console.log('❌ Usuário não autenticado');
                showToast('🔒 Faça login para criar personagens', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            }
        });

        // ===========================================
        // SISTEMA DE ABAS
        // ===========================================
        function switchTab(tabId) {
            if (!isInitialized) return;
            
            // Remove active de todas as abas e botões
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Ativa a aba selecionada
            const tabElement = document.getElementById(tabId);
            if (tabElement) {
                tabElement.classList.add('active');
            }

            // Ativa o botão correspondente
            const tabBtn = document.getElementById(`tab${capitalizeFirstLetter(tabId)}`);
            if (tabBtn) {
                tabBtn.classList.add('active');
            }

            // Salva a última aba acessada
            localStorage.setItem('lastTab', tabId);
            
            // Rola para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Dispara evento para inicialização específica da aba
            if (typeof window[`init${capitalizeFirstLetter(tabId)}Tab`] === 'function') {
                window[`init${capitalizeFirstLetter(tabId)}Tab`]();
            }
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // ===========================================
        // CARREGAR DADOS DO PERSONAGEM
        // ===========================================
        async function loadCharacterData() {
            // Verifica se tem ID de personagem na URL
            const urlParams = new URLSearchParams(window.location.search);
            const charId = urlParams.get('id');

            if (charId) {
                // CARREGAR PERSONAGEM EXISTENTE
                try {
                    const charDoc = await db.collection('characters').doc(charId).get();
                    
                    if (charDoc.exists && charDoc.data().owner === currentUser.uid) {
                        currentCharacterId = charId;
                        const charData = charDoc.data();
                        
                        // Preenche dados básicos
                        document.getElementById('characterName').value = charData.name || '';
                        
                        showToast('📜 Personagem carregado: ' + charData.name, 'success');
                        
                        // Carrega última aba acessada
                        const lastTab = charData.lastTab || 'atributos';
                        setTimeout(() => switchTab(lastTab), 100);
                    } else {
                        showToast('❌ Personagem não encontrado ou acesso negado', 'error');
                        currentCharacterId = null;
                        switchTab('atributos');
                    }
                } catch (error) {
                    console.error('Erro ao carregar personagem:', error);
                    showToast('❌ Erro ao carregar personagem', 'error');
                    switchTab('atributos');
                }
            } else {
                // NOVO PERSONAGEM
                currentCharacterId = null;
                document.getElementById('characterName').value = '';
                
                // Restaura última aba acessada ou vai para atributos
                const lastTab = localStorage.getItem('lastTab') || 'atributos';
                setTimeout(() => switchTab(lastTab), 100);
            }
        }

        // ===========================================
        // SALVAR RASCUNHO
        // ===========================================
        async function saveDraft() {
            if (!currentUser) {
                showToast('❌ Faça login para salvar', 'error');
                return;
            }

            const characterName = document.getElementById('characterName').value.trim();
            if (!characterName) {
                showToast('⚠️ Digite um nome para o personagem', 'warning');
                document.getElementById('characterName').focus();
                return;
            }

            const characterData = {
                name: characterName,
                owner: currentUser.uid,
                lastTab: localStorage.getItem('lastTab') || 'atributos',
                lastUpdated: new Date().toISOString(),
                status: 'draft'
            };

            try {
                if (currentCharacterId) {
                    // Atualiza personagem existente
                    await db.collection('characters').doc(currentCharacterId).update(characterData);
                    showToast('💾 Rascunho atualizado', 'success');
                } else {
                    // Cria novo personagem
                    const docRef = await db.collection('characters').add({
                        ...characterData,
                        createdAt: new Date().toISOString()
                    });
                    currentCharacterId = docRef.id;
                    
                    // Atualiza URL com o ID
                    window.history.replaceState({}, '', `?id=${currentCharacterId}`);
                    showToast('✅ Personagem criado e salvo', 'success');
                }
            } catch (error) {
                console.error('Erro ao salvar:', error);
                showToast('❌ Erro ao salvar personagem', 'error');
            }
        }

        // ===========================================
        // FINALIZAR PERSONAGEM
        // ===========================================
        async function finalizeCharacter() {
            if (!currentUser) {
                showToast('❌ Faça login para finalizar', 'error');
                return;
            }

            const characterName = document.getElementById('characterName').value.trim();
            if (!characterName) {
                showToast('⚠️ Digite um nome para o personagem', 'warning');
                return;
            }

            showToast('🎉 Personagem finalizado com sucesso!', 'success');
            
            // Redireciona para a página do personagem após 2 segundos
            setTimeout(() => {
                window.location.href = 'modo-personagem.html';
            }, 2000);
        }

        // ===========================================
        // FUNÇÕES AUXILIARES
        // ===========================================
        function goBack() {
            window.location.href = 'modo-personagem.html';
        }

        function cancelCreation() {
            if (confirm('Tem certeza que deseja cancelar? Todo progresso não salvo será perdido.')) {
                window.location.href = 'modo-personagem.html';
            }
        }

        function resetCharacter() {
            if (confirm('Isso vai limpar TODOS os dados do personagem. Continuar?')) {
                document.getElementById('characterName').value = '';
                currentCharacterId = null;
                localStorage.removeItem('lastTab');
                showToast('🔄 Personagem resetado', 'info');
                switchTab('atributos');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('custom-toast');
            toast.innerHTML = `<i class="fas fa-${getToastIcon(type)}"></i> ${message}`;
            toast.style.display = 'block';
            
            const bgColor = type === 'error' ? 'var(--accent-red)' : 
                           type === 'success' ? 'var(--accent-green)' : 
                           type === 'warning' ? 'var(--primary-gold)' : 
                           'var(--secondary-dark)';
            
            toast.style.background = bgColor;
            toast.style.animation = 'slideIn 0.3s ease';
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 300);
            }, 3000);
        }

        function getToastIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        // ===========================================
        // AUTO-SAVE A CADA 30 SEGUNDOS
        // ===========================================
        let autoSaveTimer;
        document.getElementById('characterName').addEventListener('input', () => {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                if (currentCharacterId && isInitialized) {
                    saveDraft();
                }
            }, 30000);
        });

        // ===========================================
        // INICIALIZAÇÃO DAS ABAS ESPECÍFICAS
        // ===========================================
        // Funções placeholder que podem ser sobrescritas
        window.initAtributosTab = function() {
            console.log('⚔️ Inicializando aba de Atributos...');
            iniciarSistemaAtributos();
        };

        window.initCaracteristicasTab = function() {
            console.log('👤 Inicializando aba de Características...');
            iniciarSistemaCaracteristicas();
        };

        window.initVantagensTab = function() {
            console.log('⭐ Inicializando aba de Vantagens...');
            iniciarSistemaVantagens();
        };

        // ===========================================
        // SISTEMA DE ATRIBUTOS
        // ===========================================
        function iniciarSistemaAtributos() {
            console.log('🔄 Inicializando sistema de atributos...');
            
            // Inicializa valores iniciais
            atualizarAtributosSecundarios();
            atualizarTabelasReferencia();
            
            // Adiciona eventos aos inputs
            document.querySelectorAll('.input-atributo').forEach(input => {
                input.addEventListener('change', function() {
                    const atributo = this.id;
                    const valor = parseInt(this.value) || 10;
                    calcularCustoAtributo(atributo, valor);
                    atualizarAtributosSecundarios();
                    atualizarTabelasReferencia();
                });
            });
            
            // Adiciona eventos aos botões de bonus
            document.querySelectorAll('.secundario-bonus').forEach(input => {
                input.addEventListener('change', function() {
                    atualizarAtributosSecundarios();
                });
            });
            
            showToast('✅ Sistema de atributos inicializado', 'success');
        }

        function alterarAtributo(atributo, delta) {
            const input = document.getElementById(atributo);
            let valor = parseInt(input.value) || 10;
            valor += delta;
            
            // Limites
            const min = parseInt(input.min) || 1;
            const max = parseInt(input.max) || 40;
            valor = Math.max(min, Math.min(max, valor));
            
            input.value = valor;
            calcularCustoAtributo(atributo, valor);
            atualizarAtributosSecundarios();
            atualizarTabelasReferencia();
        }

        function calcularCustoAtributo(atributo, valor) {
            let custo = 0;
            
            // Cálculo padrão GURPS: cada ponto acima de 10 custa 10, cada ponto abaixo de 10 dá 10
            if (valor > 10) {
                custo = (valor - 10) * 10;
            } else if (valor < 10) {
                custo = (valor - 10) * 10; // Negativo (desvantagem)
            }
            
            document.getElementById(`custo${atributo}`).textContent = custo;
            calcularPontosTotais();
            return custo;
        }

        function ajustarSecundario(tipo, delta) {
            const inputId = tipo === 'Deslocamento' ? 'bonusDeslocamento' : `bonus${tipo}`;
            const input = document.getElementById(inputId);
            let valor = parseFloat(input.value) || 0;
            
            const step = tipo === 'Deslocamento' ? 0.25 : 1;
            valor += delta * step;
            valor = Math.round(valor / step) * step; // Arredonda para o step mais próximo
            
            input.value = valor;
            atualizarAtributosSecundarios();
        }

        function atualizarAtributosSecundarios() {
            // Valores base dos atributos principais
            const ST = parseInt(document.getElementById('ST').value) || 10;
            const DX = parseInt(document.getElementById('DX').value) || 10;
            const IQ = parseInt(document.getElementById('IQ').value) || 10;
            const HT = parseInt(document.getElementById('HT').value) || 10;
            
            // Atualiza bases
            document.getElementById('PVBase').textContent = ST;
            document.getElementById('PFBase').textContent = HT;
            document.getElementById('VontadeBase').textContent = IQ + 1;
            document.getElementById('PercepcaoBase').textContent = IQ + 1;
            
            // Velocidade base = (DX + HT) / 4
            const velocidadeBase = (DX + HT) / 4;
            document.getElementById('DeslocamentoBase').textContent = velocidadeBase.toFixed(2);
            
            // Calcula totais com bônus
            const bonusPV = parseInt(document.getElementById('bonusPV').value) || 0;
            const bonusPF = parseInt(document.getElementById('bonusPF').value) || 0;
            const bonusVontade = parseInt(document.getElementById('bonusVontade').value) || 0;
            const bonusPercepcao = parseInt(document.getElementById('bonusPercepcao').value) || 0;
            const bonusDeslocamento = parseFloat(document.getElementById('bonusDeslocamento').value) || 0;
            
            document.getElementById('PVTotal').textContent = ST + bonusPV;
            document.getElementById('PFTotal').textContent = HT + bonusPF;
            document.getElementById('VontadeTotal').textContent = (IQ + 1) + bonusVontade;
            document.getElementById('PercepcaoTotal').textContent = (IQ + 1) + bonusPercepcao;
            document.getElementById('DeslocamentoTotal').textContent = (velocidadeBase + bonusDeslocamento).toFixed(2);
            
            // Atualiza referências
            document.getElementById('currentST').textContent = ST;
            document.getElementById('currentST2').textContent = ST;
        }

        function atualizarTabelasReferencia() {
            const ST = parseInt(document.getElementById('ST').value) || 10;
            
            // Tabela de Dano
            const tabelaDano = {
                1: '1d-5', 2: '1d-5', 3: '1d-4', 4: '1d-4', 5: '1d-3',
                6: '1d-3', 7: '1d-2', 8: '1d-2', 9: '1d-1', 10: '1d',
                11: '1d+1', 12: '1d+2', 13: '2d-1', 14: '2d', 15: '2d+1',
                16: '2d+2', 17: '3d-1', 18: '3d', 19: '3d+1', 20: '3d+2'
            };
            
            let danoGDP = '1d-2';
            let danoGEB = '1d';
            
            if (ST >= 1 && ST <= 20) {
                const danoValor = Math.max(1, Math.min(20, ST));
                danoGEB = tabelaDano[danoValor] || '1d';
                
                // GDP é geralmente 2 pontos menor que GEB
                const gdpValor = Math.max(1, danoValor - 2);
                danoGDP = tabelaDano[gdpValor] || '1d-2';
            }
            
            document.getElementById('danoGDP').textContent = danoGDP;
            document.getElementById('danoGEB').textContent = danoGEB;
            
            // Tabela de Carga
            const cargaNenhuma = ST;
            const cargaLeve = ST * 2;
            const cargaMedia = ST * 3;
            const cargaPesada = ST * 6;
            const cargaMuitoPesada = ST * 10;
            
            document.getElementById('cargaNenhuma').textContent = cargaNenhuma.toFixed(1);
            document.getElementById('cargaLeve').textContent = cargaLeve.toFixed(1);
            document.getElementById('cargaMedia').textContent = cargaMedia.toFixed(1);
            document.getElementById('cargaPesada').textContent = cargaPesada.toFixed(1);
            document.getElementById('cargaMuitoPesada').textContent = cargaMuitoPesada.toFixed(1);
        }

        function calcularPontosTotais() {
            let total = 0;
            
            // Soma custos dos atributos principais
            total += parseInt(document.getElementById('custoST').textContent) || 0;
            total += parseInt(document.getElementById('custoDX').textContent) || 0;
            total += parseInt(document.getElementById('custoIQ').textContent) || 0;
            total += parseInt(document.getElementById('custoHT').textContent) || 0;
            
            document.getElementById('pontosGastos').textContent = total;
            
            // Atualiza status
            const status = document.getElementById('statusAtributos');
            if (total > 100) {
                status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> <span>ATENÇÃO: Pontos gastos (' + total + ') acima do limite recomendado (100)</span>';
                status.style.background = 'rgba(139, 0, 0, 0.3)';
                status.style.borderColor = 'var(--accent-red)';
            } else if (total > 50) {
                status.innerHTML = '<i class="fas fa-info-circle"></i> <span>Personagem experiente (' + total + ' pontos gastos)</span>';
                status.style.background = 'rgba(212, 175, 55, 0.2)';
                status.style.borderColor = 'var(--primary-gold)';
            } else {
                status.innerHTML = '<i class="fas fa-check-circle"></i> <span>Sistema de atributos inicializado. Ajuste os valores conforme necessário.</span>';
                status.style.background = 'rgba(44, 32, 8, 0.8)';
                status.style.borderColor = 'var(--primary-gold)';
            }
        }

        // ===========================================
        // SISTEMA DE CARACTERÍSTICAS
        // ===========================================
        function iniciarSistemaCaracteristicas() {
            console.log('🔄 Inicializando sistema de características...');
            
            // Inicializa subtabs
            document.querySelectorAll('.subtab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const subtabId = this.getAttribute('data-subtab');
                    
                    // Remove active de todas
                    document.querySelectorAll('.subtab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    document.querySelectorAll('.subtab-pane').forEach(p => {
                        p.classList.remove('active');
                    });
                    
                    // Ativa a selecionada
                    this.classList.add('active');
                    document.getElementById('subtab-' + subtabId).classList.add('active');
                });
            });
            
            // Inicializa aparência física
            const selectAparencia = document.getElementById('nivelAparencia');
            if (selectAparencia) {
                selectAparencia.addEventListener('change', function() {
                    const valor = parseInt(this.value);
                    const texto = this.options[this.selectedIndex].text;
                    const partes = texto.split(' [');
                    
                    document.getElementById('pontosAparencia').textContent = valor + ' pts';
                    document.getElementById('displayAparencia').innerHTML = `
                        <strong>${partes[0]}</strong>
                        <br><small>Reação: ${valor >= 0 ? '+' : ''}${Math.floor(valor/4)}</small>
                        <br><small>${getDescricaoAparencia(valor)}</small>
                    `;
                    calcularPontosCaracteristicas();
                });
            }
            
            // Inicializa riqueza
            const selectRiqueza = document.getElementById('nivelRiqueza');
            if (selectRiqueza) {
                selectRiqueza.addEventListener('change', function() {
                    const valor = parseInt(this.value);
                    const texto = this.options[this.selectedIndex].text;
                    const partes = texto.split(' [');
                    
                    document.getElementById('pontosRiqueza').textContent = valor + ' pts';
                    document.getElementById('displayRiqueza').innerHTML = `
                        <strong>${partes[0]}</strong>
                        <br><small>Multiplicador: ${getMultiplicadorRiqueza(valor)}x</small>
                        <br><small>${getDescricaoRiqueza(valor)}</small>
                    `;
                    
                    // Atualiza renda mensal
                    const rendaBase = 1000;
                    const multiplicador = getMultiplicadorRiqueza(valor);
                    document.getElementById('rendaMensal').textContent = `$${(rendaBase * multiplicador).toLocaleString()}`;
                    
                    calcularPontosCaracteristicas();
                });
            }
            
            // Inicializa características físicas
            document.querySelectorAll('.btn-add-caracteristica').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tipo = this.getAttribute('data-tipo');
                    adicionarCaracteristicaFisica(tipo);
                });
            });
            
            // Inicializa controles de altura e peso
            const alturaInput = document.getElementById('altura');
            const pesoInput = document.getElementById('peso');
            
            if (alturaInput) {
                alturaInput.addEventListener('change', function() {
                    atualizarStatusAlturaPeso();
                });
            }
            
            if (pesoInput) {
                pesoInput.addEventListener('change', function() {
                    atualizarStatusAlturaPeso();
                });
            }
            
            // Inicializa controles visuais
            document.querySelectorAll('.select-visual').forEach(select => {
                select.addEventListener('change', atualizarDescricaoVisual);
            });
            
            const idadeInput = document.getElementById('idade-personagem');
            if (idadeInput) {
                idadeInput.addEventListener('change', atualizarDescricaoVisual);
            }
            
            showToast('✅ Sistema de características inicializado', 'success');
        }

        function getDescricaoAparencia(pontos) {
            const descricoes = {
                '-24': 'Aparência terrível, penalidade social severa',
                '-20': 'Muito feio, causa desconforto',
                '-16': 'Feiura notável',
                '-8': 'Pouco atraente',
                '-4': 'Sem atrativos especiais',
                '0': 'Aparência comum, sem modificadores',
                '4': 'Boa aparência, recebe atenção positiva',
                '12': 'Muito atraente, impressiona à primeira vista',
                '16': 'Beleza notável, destaca-se em multidões',
                '20': 'Extremamente belo, quase sobrenatural'
            };
            return descricoes[pontos] || 'Aparência padrão';
        }

        function getMultiplicadorRiqueza(pontos) {
            const multiplicadores = {
                '-25': 0.1,
                '-15': 0.2,
                '-10': 0.5,
                '0': 1,
                '10': 2,
                '20': 5,
                '30': 10,
                '50': 20
            };
            return multiplicadores[pontos] || 1;
        }

        function getDescricaoRiqueza(pontos) {
            const descricoes = {
                '-25': 'Pobreza extrema, depende de caridade',
                '-15': 'Vive no limite, sem reservas',
                '-10': 'Luta para sobreviver',
                '0': 'Recursos suficientes para necessidades básicas',
                '10': 'Vida confortável, pequenos luxos',
                '20': 'Rico, vida de luxo',
                '30': 'Muito rico, influência econômica',
                '50': 'Fortuna colossal, poder ilimitado'
            };
            return descricoes[pontos] || 'Nível de recursos padrão';
        }

        function calcularPontosCaracteristicas() {
            let total = 0;
            
            // Aparência
            const pontosAparencia = parseInt(document.getElementById('nivelAparencia').value) || 0;
            total += pontosAparencia;
            
            // Riqueza
            const pontosRiqueza = parseInt(document.getElementById('nivelRiqueza').value) || 0;
            total += pontosRiqueza;
            
            // Atualiza display
            document.getElementById('pontosAparencia').textContent = pontosAparencia + ' pts';
            document.getElementById('pontosRiqueza').textContent = pontosRiqueza + ' pts';
            
            console.log('Pontos totais características:', total);
        }

        function adicionarCaracteristicaFisica(tipo) {
            const caracteristicas = {
                'magro': { nome: 'Magro', pontos: -5, descricao: 'Peso: 67% do normal' },
                'acima-peso': { nome: 'Acima do Peso', pontos: -1, descricao: 'Peso: 130% do normal' },
                'gordo': { nome: 'Gordo', pontos: -3, descricao: 'Peso: 150% do normal' },
                'muito-gordo': { nome: 'Muito Gordo', pontos: -5, descricao: 'Peso: 200% do normal' },
                'nanismo': { nome: 'Nanismo', pontos: -15, descricao: 'Altura máxima: 1.32m' },
                'gigantismo': { nome: 'Gigantismo', pontos: 0, descricao: 'MT +1, +1 Deslocamento' }
            };
            
            const caract = caracteristicas[tipo];
            if (!caract) return;
            
            const container = document.getElementById('caracteristicasSelecionadas');
            const desvantagensContainer = document.getElementById('listaDesvantagens');
            const desvantagensAtivas = document.getElementById('desvantagensAtivas');
            
            // Verifica se já existe
            const existing = container.querySelector(`[data-tipo="${tipo}"]`);
            if (existing) {
                showToast('⚠️ Esta característica já foi adicionada', 'warning');
                return;
            }
            
            // Cria elemento
            const elemento = document.createElement('div');
            elemento.className = 'caracteristica-selecionada';
            elemento.setAttribute('data-tipo', tipo);
            elemento.innerHTML = `
                <div class="caracteristica-info">
                    <strong>${caract.nome}</strong>
                    <small>${caract.pontos} pts | ${caract.descricao}</small>
                </div>
                <button class="btn-remover-caracteristica" onclick="removerCaracteristicaFisica('${tipo}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(elemento);
            
            // Adiciona à lista de desvantagens ativas
            if (caract.pontos < 0) {
                desvantagensAtivas.style.display = 'block';
                
                const desvElement = document.createElement('div');
                desvElement.className = 'desvantagem-item';
                desvElement.setAttribute('data-tipo', tipo);
                desvElement.innerHTML = `
                    <span class="desvantagem-nome">${caract.nome}</span>
                    <span class="desvantagem-pontos">${caract.pontos} pts</span>
                `;
                
                desvantagensContainer.appendChild(desvElement);
            }
            
            // Atualiza pontos
            const pontosAtuais = parseInt(document.getElementById('pontosCaracteristicas').textContent) || 0;
            document.getElementById('pontosCaracteristicas').textContent = (pontosAtuais + caract.pontos) + ' pts';
            
            // Aplica efeitos
            aplicarEfeitoCaracteristica(tipo, caract);
            
            showToast(`✅ ${caract.nome} adicionado`, 'success');
        }

        function removerCaracteristicaFisica(tipo) {
            const container = document.getElementById('caracteristicasSelecionadas');
            const elemento = container.querySelector(`[data-tipo="${tipo}"]`);
            const desvElement = document.getElementById('listaDesvantagens')?.querySelector(`[data-tipo="${tipo}"]`);
            
            if (!elemento) return;
            
            // Remove dos pontos
            const caracteristicas = {
                'magro': -5, 'acima-peso': -1, 'gordo': -3, 
                'muito-gordo': -5, 'nanismo': -15, 'gigantismo': 0
            };
            
            const pontos = caracteristicas[tipo] || 0;
            const pontosAtuais = parseInt(document.getElementById('pontosCaracteristicas').textContent) || 0;
            document.getElementById('pontosCaracteristicas').textContent = (pontosAtuais - pontos) + ' pts';
            
            // Remove elementos
            elemento.remove();
            if (desvElement) desvElement.remove();
            
            // Remove efeitos
            removerEfeitoCaracteristica(tipo);
            
            // Esconde container de desvantagens se vazio
            const desvantagensAtivas = document.getElementById('desvantagensAtivas');
            const listaDesv = document.getElementById('listaDesvantagens');
            if (listaDesv && listaDesv.children.length === 0) {
                desvantagensAtivas.style.display = 'none';
            }
            
            showToast('🗑️ Característica removida', 'info');
        }

        function aplicarEfeitoCaracteristica(tipo, caract) {
            // Implemente os efeitos reais das características aqui
            console.log(`Aplicando efeito: ${tipo}`, caract);
            
            switch(tipo) {
                case 'magro':
                    // Ajusta peso para 67% do normal
                    ajustarPesoPorcentagem(0.67);
                    break;
                case 'acima-peso':
                    ajustarPesoPorcentagem(1.3);
                    break;
                case 'gordo':
                    ajustarPesoPorcentagem(1.5);
                    break;
                case 'muito-gordo':
                    ajustarPesoPorcentagem(2.0);
                    break;
                case 'nanismo':
                    // Limita altura máxima
                    const alturaInput = document.getElementById('altura');
                    if (parseFloat(alturaInput.value) > 1.32) {
                        alturaInput.value = 1.32;
                        atualizarStatusAlturaPeso();
                    }
                    alturaInput.max = 1.32;
                    break;
                case 'gigantismo':
                    // Ajusta deslocamento
                    const bonusDeslocamento = document.getElementById('bonusDeslocamento');
                    bonusDeslocamento.value = (parseFloat(bonusDeslocamento.value) || 0) + 1;
                    atualizarAtributosSecundarios();
                    break;
            }
        }

        function removerEfeitoCaracteristica(tipo) {
            console.log(`Removendo efeito: ${tipo}`);
            
            switch(tipo) {
                case 'nanismo':
                    document.getElementById('altura').max = 2.50;
                    break;
                case 'gigantismo':
                    const bonusDeslocamento = document.getElementById('bonusDeslocamento');
                    bonusDeslocamento.value = Math.max(0, (parseFloat(bonusDeslocamento.value) || 0) - 1);
                    atualizarAtributosSecundarios();
                    break;
            }
        }

        function ajustarPesoPorcentagem(porcentagem) {
            const pesoInput = document.getElementById('peso');
            const ST = parseInt(document.getElementById('ST').value) || 10;
            const pesoIdeal = ST * 7; // Peso médio para ST
            pesoInput.value = Math.round(pesoIdeal * porcentagem);
            atualizarStatusAlturaPeso();
        }

        function ajustarAltura(delta) {
            const input = document.getElementById('altura');
            let valor = parseFloat(input.value) || 1.70;
            valor += delta;
            valor = Math.max(parseFloat(input.min) || 1.20, Math.min(parseFloat(input.max) || 2.50, valor));
            input.value = valor.toFixed(2);
            atualizarStatusAlturaPeso();
        }

        function ajustarPeso(delta) {
            const input = document.getElementById('peso');
            let valor = parseInt(input.value) || 70;
            valor += delta;
            valor = Math.max(parseInt(input.min) || 20, Math.min(parseInt(input.max) || 200, valor));
            input.value = valor;
            atualizarStatusAlturaPeso();
        }

        function ajustarIdade(delta) {
            const input = document.getElementById('idade-personagem');
            let valor = parseInt(input.value) || 25;
            valor += delta;
            valor = Math.max(parseInt(input.min) || 12, Math.min(parseInt(input.max) || 100, valor));
            input.value = valor;
            atualizarDescricaoVisual();
        }

        function atualizarStatusAlturaPeso() {
            const altura = parseFloat(document.getElementById('altura').value) || 1.70;
            const peso = parseInt(document.getElementById('peso').value) || 70;
            const ST = parseInt(document.getElementById('ST').value) || 10;
            
            // Cálculo do IMC
            const imc = peso / (altura * altura);
            
            // Faixas de altura/peso para ST (GURPS)
            const alturaMinima = 1.45 + (ST - 10) * 0.025;
            const alturaMaxima = 1.80 + (ST - 10) * 0.025;
            const pesoMinimo = 45 + (ST - 10) * 2.5;
            const pesoMaximo = 90 + (ST - 10) * 2.5;
            
            // Atualiza displays
            document.getElementById('stBase').textContent = ST;
            document.getElementById('alturaFaixa').textContent = alturaMinima.toFixed(2) + 'm - ' + alturaMaxima.toFixed(2) + 'm';
            document.getElementById('pesoFaixa').textContent = pesoMinimo + 'kg - ' + pesoMaximo + 'kg';
            
            // Status da altura
            let statusAltura = '';
            if (altura < alturaMinima) {
                statusAltura = 'Abaixo da faixa (ST muito alto para altura)';
            } else if (altura > alturaMaxima) {
                statusAltura = 'Acima da faixa (ST muito baixo para altura)';
            } else {
                statusAltura = 'Dentro da faixa normal';
            }
            
            // Status do peso
            let statusPeso = '';
            if (peso < pesoMinimo) {
                statusPeso = 'Abaixo do peso';
            } else if (peso > pesoMaximo) {
                statusPeso = 'Acima do peso';
            } else {
                statusPeso = 'Peso normal';
            }
            
            document.getElementById('statusAltura').textContent = statusAltura;
            document.getElementById('statusPeso').textContent = statusPeso;
            
            // Status geral
            let statusGeral = 'Normal';
            let statusClass = 'normal';
            
            if (altura < alturaMinima || altura > alturaMaxima || 
                peso < pesoMinimo || peso > pesoMaximo) {
                statusGeral = 'Fora da faixa recomendada';
                statusClass = 'warning';
            }
            
            document.getElementById('statusFisico').textContent = statusGeral;
            document.getElementById('statusFisico').className = 'status-badge ' + statusClass;
            document.getElementById('modificadorPeso').textContent = statusPeso;
            
            // Atualiza cor dos status
            const statusAlturaElem = document.getElementById('statusAltura');
            const statusPesoElem = document.getElementById('statusPeso');
            
            statusAlturaElem.style.color = altura >= alturaMinima && altura <= alturaMaxima ? 
                'rgba(212, 175, 55, 0.8)' : 'var(--accent-red)';
            
            statusPesoElem.style.color = peso >= pesoMinimo && peso <= pesoMaximo ? 
                'rgba(212, 175, 55, 0.8)' : 'var(--accent-red)';
            
            // Atualiza descrição visual
            atualizarDescricaoVisual();
        }

        function atualizarDescricaoVisual() {
            const idade = document.getElementById('idade-personagem').value || 25;
            const corPele = document.querySelector('[data-tipo="cor-pele"]').value;
            const corOlhos = document.querySelector('[data-tipo="cor-olhos"]').value;
            const corCabelo = document.querySelector('[data-tipo="cor-cabelo"]').value;
            const tipoCabelo = document.querySelector('[data-tipo="tipo-cabelo"]').value;
            
            const descricao = `${idade} anos, pele ${corPele.toLowerCase()}, olhos ${corOlhos.toLowerCase()}, cabelo ${corCabelo.toLowerCase()} ${tipoCabelo.toLowerCase()}`;
            document.getElementById('descricaoVisual').textContent = descricao;
        }

        // ===========================================
        // SISTEMA DE VANTAGENS
        // ===========================================
        function iniciarSistemaVantagens() {
            console.log('🔄 Inicializando sistema de vantagens...');
            
            // Inicializa subtabs
            document.querySelectorAll('.subtab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const subtabId = this.getAttribute('data-subtab');
                    
                    // Remove active de todas
                    document.querySelectorAll('.subtab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    document.querySelectorAll('.subtab-pane').forEach(p => {
                        p.classList.remove('active');
                    });
                    
                    // Ativa a selecionada
                    this.classList.add('active');
                    document.getElementById('subtab-' + subtabId).classList.add('active');
                });
            });
            
            // Inicializa controles de atributos complementares
            document.querySelectorAll('.atributo-item').forEach(item => {
                const botoesDirecao = item.querySelectorAll('.btn-vantagem, .btn-desvantagem');
                const botoesNivel = item.querySelectorAll('.btn-nivel');
                const nivelDisplay = item.querySelector('.nivel-display');
                const statusDirecao = item.querySelector('.status-direcao');
                const custoDisplay = item.querySelector('.custo-valor');
                
                botoesDirecao.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const direcao = this.getAttribute('data-direcao');
                        const tipo = item.getAttribute('data-tipo');
                        const custoPorNivel = parseInt(item.getAttribute('data-custo')) || 5;
                        const fator = parseFloat(item.getAttribute('data-fator')) || 1;
                        
                        // Ativa os botões de nível
                        botoesNivel.forEach(b => b.disabled = false);
                        
                        // Atualiza status
                        statusDirecao.textContent = direcao === 'positivo' ? 'Vantagem' : 'Desvantagem';
                        statusDirecao.className = `status-direcao ${direcao}`;
                        
                        // Reinicia nível
                        nivelDisplay.textContent = direcao === 'positivo' ? '0' : '0';
                        atualizarCustoAtributo(item, 0, custoPorNivel, fator, direcao);
                        
                        // Atualiza eventos dos botões de nível
                        botoesNivel[0].onclick = () => ajustarNivelAtributo(item, -1, custoPorNivel, fator, direcao);
                        botoesNivel[1].onclick = () => ajustarNivelAtributo(item, 1, custoPorNivel, fator, direcao);
                    });
                });
            });
            
            // Inicializa controles de status
            document.querySelectorAll('[name="status-direcao"], [name="reputacao-direcao"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const nome = this.name;
                    const direcao = this.value;
                    const tipo = nome === 'status-direcao' ? 'status' : 'reputacao';
                    
                    atualizarControlesStatus(tipo, direcao);
                });
            });
            
            // Inicializa botões de nível de status
            document.querySelectorAll('.btn-nivel-status').forEach(btn => {
                const isMais = btn.classList.contains('mais');
                const tipo = btn.closest('.status-item').getAttribute('data-tipo');
                
                btn.addEventListener('click', function() {
                    if (this.disabled) return;
                    
                    const contador = this.closest('.nivel-contador');
                    const nivelValor = contador.querySelector('.nivel-valor');
                    const custoTotal = contador.closest('.status-controles').querySelector('.custo-total');
                    const radioGroup = contador.closest('.status-controles').querySelector('.direcao-selecao');
                    const radioSelecionado = radioGroup.querySelector('input:checked');
                    
                    if (!radioSelecionado) return;
                    
                    const direcao = radioSelecionado.value;
                    if (direcao === 'neutro') return;
                    
                    let nivel = parseInt(nivelValor.textContent) || 0;
                    const incremento = isMais ? 1 : -1;
                    const maxNiveis = 4; // Máximo de níveis
                    
                    // Limites
                    if (isMais && nivel >= maxNiveis) {
                        showToast(`⚠️ Máximo de ${maxNiveis} níveis atingido`, 'warning');
                        return;
                    }
                    
                    if (!isMais && nivel <= 0) return;
                    
                    nivel += incremento;
                    nivel = Math.max(0, Math.min(maxNiveis, nivel));
                    nivelValor.textContent = nivel;
                    
                    // Calcula custo
                    const custoPorNivel = parseInt(contador.closest('.status-item').getAttribute('data-custo')) || 5;
                    let custo = nivel * custoPorNivel;
                    
                    if (direcao === 'negativo') {
                        custo = -custo; // Desvantagem dá pontos
                    }
                    
                    custoTotal.textContent = custo;
                    
                    // Atualiza descrição
                    atualizarDescricaoStatus(tipo, nivel, direcao);
                    
                    // Atualiza totais
                    calcularTotaisVantagens();
                });
            });
            
            showToast('✅ Sistema de vantagens inicializado', 'success');
        }

        function ajustarNivelAtributo(item, delta, custoPorNivel, fator, direcao) {
            const nivelDisplay = item.querySelector('.nivel-display');
            const statusDirecao = item.querySelector('.status-direcao');
            const custoDisplay = item.querySelector('.custo-valor');
            const botoesNivel = item.querySelectorAll('.btn-nivel');
            
            let nivel = parseFloat(nivelDisplay.textContent) || 0;
            let novoNivel = nivel + (delta * fator);
            
            // Limites mínimos
            if (novoNivel < 0) novoNivel = 0;
            
            // Para atributos com fator decimal, formata corretamente
            if (fator !== 1) {
                novoNivel = Math.round(novoNivel / fator) * fator;
                nivelDisplay.textContent = novoNivel.toFixed(2);
            } else {
                nivelDisplay.textContent = novoNivel;
            }
            
            // Atualiza custo
            atualizarCustoAtributo(item, novoNivel, custoPorNivel, fator, direcao);
            
            // Habilita/desabilita botões
            botoesNivel[0].disabled = novoNivel <= 0;
            
            // Atualiza totais
            calcularTotaisVantagens();
        }

        function atualizarCustoAtributo(item, nivel, custoPorNivel, fator, direcao) {
            const custoDisplay = item.querySelector('.custo-valor');
            let custo = (nivel / fator) * custoPorNivel;
            
            if (direcao === 'negativo') {
                custo = -Math.abs(custo); // Desvantagem dá pontos negativos
            }
            
            custoDisplay.textContent = Math.round(custo);
        }

        function atualizarControlesStatus(tipo, direcao) {
            const statusItem = document.querySelector(`[data-tipo="${tipo}"]`);
            if (!statusItem) return;
            
            const botoesNivel = statusItem.querySelectorAll('.btn-nivel-status');
            const nivelValor = statusItem.querySelector('.nivel-valor');
            const custoTotal = statusItem.querySelector('.custo-total');
            
            if (direcao === 'neutro') {
                // Desabilita controles
                botoesNivel.forEach(btn => btn.disabled = true);
                nivelValor.textContent = '0';
                custoTotal.textContent = '0';
                atualizarDescricaoStatus(tipo, 0, 'neutro');
            } else {
                // Habilita controles
                botoesNivel.forEach(btn => btn.disabled = false);
                nivelValor.textContent = '0';
                custoTotal.textContent = '0';
                atualizarDescricaoStatus(tipo, 0, direcao);
            }
            
            calcularTotaisVantagens();
        }

        function atualizarDescricaoStatus(tipo, nivel, direcao) {
            const descElement = document.getElementById(`desc${capitalizeFirstLetter(tipo)}`);
            if (!descElement) return;
            
            let descricao = '';
            
            if (direcao === 'neutro') {
                descricao = tipo === 'status' ? 
                    'Status padrão, sem modificadores' : 
                    'Reputação padrão, sem modificadores';
            } else if (direcao === 'positivo') {
                if (tipo === 'status') {
                    const statusNiveis = [
                        'Status padrão',
                        'Status acima da média (ex: oficial júnior)',
                        'Status elevado (ex: oficial sênior)',
                        'Status alto (ex: nobre menor)',
                        'Status muito alto (ex: nobre maior)'
                    ];
                    descricao = statusNiveis[Math.min(nivel, 4)];
                } else {
                    const reputacaoNiveis = [
                        'Reputação padrão',
                        'Pequena reputação local',
                        'Reputação regional',
                        'Reputação nacional',
                        'Reputação lendária'
                    ];
                    descricao = reputacaoNiveis[Math.min(nivel, 4)];
                }
            } else {
                if (tipo === 'status') {
                    const statusNiveis = [
                        'Status padrão',
                        'Status abaixo da média',
                        'Status baixo (ex: servo)',
                        'Status muito baixo (ex: escravo)',
                        'Status pária'
                    ];
                    descricao = statusNiveis[Math.min(nivel, 4)];
                } else {
                    const reputacaoNiveis = [
                        'Reputação padrão',
                        'Pequena má reputação local',
                        'Má reputação regional',
                        'Má reputação nacional',
                        'Reputação infame'
                    ];
                    descricao = reputacaoNiveis[Math.min(nivel, 4)];
                }
            }
            
            descElement.textContent = descricao;
        }

        function calcularTotaisVantagens() {
            let totalAtributos = 0;
            let totalStatusRep = 0;
            
            // Soma atributos complementares
            document.querySelectorAll('.atributo-item .custo-valor').forEach(custo => {
                totalAtributos += parseInt(custo.textContent) || 0;
            });
            
            // Soma status e reputação
            document.querySelectorAll('.status-item .custo-total').forEach(custo => {
                totalStatusRep += parseInt(custo.textContent) || 0;
            });
            
            // Atualiza displays
            document.getElementById('totalAtributos').textContent = totalAtributos;
            document.getElementById('totalStatusRep').textContent = totalStatusRep;
            document.getElementById('totalGeral').textContent = totalAtributos + totalStatusRep;
            
            // Atualiza badges
            document.getElementById('pontosAtributos').textContent = totalAtributos + ' pts';
            document.getElementById('pontosStatus').textContent = totalStatusRep + ' pts';
        }

        // ===========================================
        // INICIALIZAÇÃO GERAL
        // ===========================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🏰 Editor de Personagem GURPS carregado');
            
            // Adiciona classe para animação de entrada
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease';
                document.body.style.opacity = '1';
            }, 100);
            
            // Inicializa sistemas específicos se as abas correspondentes estiverem ativas
            setTimeout(() => {
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab) {
                    const tabId = activeTab.id;
                    if (typeof window[`init${capitalizeFirstLetter(tabId)}Tab`] === 'function') {
                        window[`init${capitalizeFirstLetter(tabId)}Tab`]();
                    }
                }
            }, 500);
        });

        // Funções auxiliares para sistemas externos
        window.getCharacterData = function() {
            return {
                name: document.getElementById('characterName').value,
                attributes: {
                    ST: parseInt(document.getElementById('ST').value) || 10,
                    DX: parseInt(document.getElementById('DX').value) || 10,
                    IQ: parseInt(document.getElementById('IQ').value) || 10,
                    HT: parseInt(document.getElementById('HT').value) || 10
                },
                points: {
                    attributes: parseInt(document.getElementById('pontosGastos').textContent) || 0,
                    characteristics: parseInt(document.getElementById('pontosCaracteristicas').textContent) || 0,
                    advantages: parseInt(document.getElementById('totalGeral').textContent) || 0
                }
            };
        };
    </script>
</body>
</html>